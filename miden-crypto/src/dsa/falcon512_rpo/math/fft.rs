use alloc::vec::Vec;
use core::ops::{Add, AddAssign, Mul, MulAssign, Neg, Sub, SubAssign};

use num::{One, Zero};

use super::{Inverse, field::FalconFelt, polynomial::Polynomial};

/// Implements Cyclotomic FFT without bitreversing the outputs, and using precomputed powers of the
/// 2n-th primitive root of unity.
pub trait FastFft: Sized + Clone {
    type Field: Add + Mul + AddAssign + MulAssign + Neg + Sub + SubAssign;
    fn fft_inplace(&mut self);
    fn fft(&self) -> Self {
        let mut a = self.clone();
        a.fft_inplace();
        a
    }

    fn ifft_inplace(&mut self);
    fn ifft(&self) -> Self {
        let mut a = self.clone();
        a.ifft_inplace();
        a
    }
}

pub trait CyclotomicFourier
where
    Self: Sized
        + Copy
        + One
        + Zero
        + Add<Output = Self>
        + Sub<Output = Self>
        + Mul<Output = Self>
        + MulAssign
        + Inverse,
{
    /// Gets the inverse of 2^n.
    #[allow(dead_code)]
    fn power_of_two_inverse(n: usize) -> Self {
        let mut a = Self::one() + Self::one();
        for _ in 0..n {
            a *= a;
        }
        Self::inverse_or_zero(a)
    }

    /// Gets a primitive nth (with n a power of 2) root of unity.
    #[allow(dead_code)]
    fn primitive_root_of_unity(n: usize) -> Self;

    /// Computes the integer whose n-bit binary expansion is the reverse of that of the argument.
    fn bitreverse_index(arg: usize, n: usize) -> usize {
        assert!(n > 0);
        assert_eq!(n & (n - 1), 0);
        let mut rev = 0;
        let mut m = n >> 1;
        let mut k = 1;
        while m > 0 {
            rev |= (((arg & m) != 0) as usize) * k;
            k <<= 1;
            m >>= 1;
        }
        rev
    }

    /// Computes the first n powers of the 2nd root of unity, and put them in bit-reversed order.
    #[allow(dead_code)]
    fn bitreversed_powers(n: usize) -> Vec<Self> {
        let psi = Self::primitive_root_of_unity(2 * n);
        let mut array = vec![Self::zero(); n];
        let mut alpha = Self::one();
        for a in array.iter_mut() {
            *a = alpha;
            alpha *= psi;
        }
        Self::bitreverse_array(&mut array);
        array
    }

    /// Computes the first n powers of the 2nd root of unity, invert them, and put them in
    /// bit-reversed order.
    #[allow(dead_code)]
    fn bitreversed_powers_inverse(n: usize) -> Vec<Self> {
        let psi = Self::primitive_root_of_unity(2 * n).inverse_or_zero();
        let mut array = vec![Self::zero(); n];
        let mut alpha = Self::one();
        for a in array.iter_mut() {
            *a = alpha;
            alpha *= psi;
        }
        Self::bitreverse_array(&mut array);
        array
    }

    /// Reorders the given elements in the array by reversing the binary expansions of their
    /// indices.
    fn bitreverse_array<T>(array: &mut [T]) {
        let n = array.len();
        for i in 0..n {
            let j = Self::bitreverse_index(i, n);
            if i < j {
                array.swap(i, j);
            }
        }
    }

    /// Computes the evaluations of the polynomial on the roots of the polynomial X^n + 1 using a
    /// fast Fourier transform. Algorithm 1 from https://eprint.iacr.org/2016/504.pdf.
    ///
    /// Arguments:
    ///
    ///  - a : &mut [Self] (a reference to) a mutable array of field elements which is to be
    ///    transformed under the FFT. The transformation happens in- place.
    ///
    ///  - psi_rev: &[Self] (a reference to) an array of powers of psi, from 0 to n-1, but ordered
    ///    by bit-reversed index. Here psi is a primitive root of order 2n. You can use
    ///    `Self::bitreversed_powers(psi, n)` for this purpose, but this trait implementation is not
    ///    const. For the performance benefit you want a precompiled array, which you can get if you
    ///    can get by implementing the same method and marking it "const".
    fn fft(a: &mut [Self], psi_rev: &[Self]) {
        let n = a.len();
        let mut t = n;
        let mut m = 1;
        while m < n {
            t >>= 1;
            for i in 0..m {
                let j1 = 2 * i * t;
                let j2 = j1 + t - 1;
                let s = psi_rev[m + i];
                for j in j1..=j2 {
                    let u = a[j];
                    let v = a[j + t] * s;
                    a[j] = u + v;
                    a[j + t] = u - v;
                }
            }
            m <<= 1;
        }
    }

    /// Computes the coefficients of the polynomial with the given evaluations on the roots of
    /// X^n + 1 using an inverse fast Fourier transform.
    /// Algorithm 2 from https://eprint.iacr.org/2016/504.pdf.
    ///
    /// Arguments:
    ///
    ///  - a : &mut [Self] (a reference to) a mutable array of field elements which is to be
    ///    transformed under the IFFT. The transformation happens in- place.
    ///
    ///  - psi_inv_rev: &[Self] (a reference to) an array of powers of psi^-1, from 0 to n-1, but
    ///    ordered by bit-reversed index. Here psi is a primitive root of order 2n. You can use
    ///    `Self::bitreversed_powers(Self::inverse_or_zero(psi), n)` for this purpose, but this
    ///    trait implementation is not const. For the performance benefit you want a precompiled
    ///    array, which you can get if you can get by implementing the same methods and marking them
    ///    "const".
    fn ifft(a: &mut [Self], psi_inv_rev: &[Self], ninv: Self) {
        let n = a.len();
        let mut t = 1;
        let mut m = n;
        while m > 1 {
            let h = m / 2;
            let mut j1 = 0;
            for i in 0..h {
                let j2 = j1 + t - 1;
                let s = psi_inv_rev[h + i];
                for j in j1..=j2 {
                    let u = a[j];
                    let v = a[j + t];
                    a[j] = u + v;
                    a[j + t] = (u - v) * s;
                }
                j1 += 2 * t;
            }
            t <<= 1;
            m >>= 1;
        }
        for ai in a.iter_mut() {
            *ai *= ninv;
        }
    }
}

impl FastFft for Polynomial<FalconFelt> {
    type Field = FalconFelt;

    fn fft_inplace(&mut self) {
        let n = self.coefficients.len();
        debug_assert!(
            (1..=512).contains(&n),
            "unsupported: n = {n} not a power of 2 or larger than 512"
        );
        FalconFelt::fft(&mut self.coefficients, &FELT_BITREVERSED_POWERS);
    }

    fn ifft_inplace(&mut self) {
        let n = self.coefficients.len();
        debug_assert!(
            (1..=512).contains(&n),
            "unsupported: n = {n} not a power of 2 or larger than 512"
        );
        let ninv = match n {
            1 => FELT_NINV_1,
            2 => FELT_NINV_2,
            4 => FELT_NINV_4,
            8 => FELT_NINV_8,
            16 => FELT_NINV_16,
            32 => FELT_NINV_32,
            64 => FELT_NINV_64,
            128 => FELT_NINV_128,
            256 => FELT_NINV_256,
            512 => FELT_NINV_512,
            _ => unreachable!("vector length is not power of 2 or larger than 512"),
        };
        FalconFelt::ifft(&mut self.coefficients, &FELT_BITREVERSED_POWERS_INVERSE, ninv);
    }
}

const FELT_BITREVERSED_POWERS: [FalconFelt; 512] = [
    FalconFelt::new(1),
    FalconFelt::new(1479),
    FalconFelt::new(8246),
    FalconFelt::new(5146),
    FalconFelt::new(4134),
    FalconFelt::new(6553),
    FalconFelt::new(11567),
    FalconFelt::new(1305),
    FalconFelt::new(5860),
    FalconFelt::new(3195),
    FalconFelt::new(1212),
    FalconFelt::new(10643),
    FalconFelt::new(3621),
    FalconFelt::new(9744),
    FalconFelt::new(8785),
    FalconFelt::new(3542),
    FalconFelt::new(7311),
    FalconFelt::new(10938),
    FalconFelt::new(8961),
    FalconFelt::new(5777),
    FalconFelt::new(5023),
    FalconFelt::new(6461),
    FalconFelt::new(5728),
    FalconFelt::new(4591),
    FalconFelt::new(3006),
    FalconFelt::new(9545),
    FalconFelt::new(563),
    FalconFelt::new(9314),
    FalconFelt::new(2625),
    FalconFelt::new(11340),
    FalconFelt::new(4821),
    FalconFelt::new(2639),
    FalconFelt::new(12149),
    FalconFelt::new(1853),
    FalconFelt::new(726),
    FalconFelt::new(4611),
    FalconFelt::new(11112),
    FalconFelt::new(4255),
    FalconFelt::new(2768),
    FalconFelt::new(1635),
    FalconFelt::new(2963),
    FalconFelt::new(7393),
    FalconFelt::new(2366),
    FalconFelt::new(9238),
    FalconFelt::new(9198),
    FalconFelt::new(12208),
    FalconFelt::new(11289),
    FalconFelt::new(7969),
    FalconFelt::new(8736),
    FalconFelt::new(4805),
    FalconFelt::new(11227),
    FalconFelt::new(2294),
    FalconFelt::new(9542),
    FalconFelt::new(4846),
    FalconFelt::new(9154),
    FalconFelt::new(8577),
    FalconFelt::new(9275),
    FalconFelt::new(3201),
    FalconFelt::new(7203),
    FalconFelt::new(10963),
    FalconFelt::new(1170),
    FalconFelt::new(9970),
    FalconFelt::new(955),
    FalconFelt::new(11499),
    FalconFelt::new(8340),
    FalconFelt::new(8993),
    FalconFelt::new(2396),
    FalconFelt::new(4452),
    FalconFelt::new(6915),
    FalconFelt::new(2837),
    FalconFelt::new(130),
    FalconFelt::new(7935),
    FalconFelt::new(11336),
    FalconFelt::new(3748),
    FalconFelt::new(6522),
    FalconFelt::new(11462),
    FalconFelt::new(5067),
    FalconFelt::new(10092),
    FalconFelt::new(12171),
    FalconFelt::new(9813),
    FalconFelt::new(8011),
    FalconFelt::new(1673),
    FalconFelt::new(5331),
    FalconFelt::new(7300),
    FalconFelt::new(10908),
    FalconFelt::new(9764),
    FalconFelt::new(4177),
    FalconFelt::new(8705),
    FalconFelt::new(480),
    FalconFelt::new(9447),
    FalconFelt::new(1022),
    FalconFelt::new(12280),
    FalconFelt::new(5791),
    FalconFelt::new(11745),
    FalconFelt::new(9821),
    FalconFelt::new(11950),
    FalconFelt::new(12144),
    FalconFelt::new(6747),
    FalconFelt::new(8652),
    FalconFelt::new(3459),
    FalconFelt::new(2731),
    FalconFelt::new(8357),
    FalconFelt::new(6378),
    FalconFelt::new(7399),
    FalconFelt::new(10530),
    FalconFelt::new(3707),
    FalconFelt::new(8595),
    FalconFelt::new(5179),
    FalconFelt::new(3382),
    FalconFelt::new(355),
    FalconFelt::new(4231),
    FalconFelt::new(2548),
    FalconFelt::new(9048),
    FalconFelt::new(11560),
    FalconFelt::new(3289),
    FalconFelt::new(10276),
    FalconFelt::new(9005),
    FalconFelt::new(9408),
    FalconFelt::new(5092),
    FalconFelt::new(10200),
    FalconFelt::new(6534),
    FalconFelt::new(4632),
    FalconFelt::new(4388),
    FalconFelt::new(1260),
    FalconFelt::new(334),
    FalconFelt::new(2426),
    FalconFelt::new(1428),
    FalconFelt::new(10593),
    FalconFelt::new(3400),
    FalconFelt::new(2399),
    FalconFelt::new(5191),
    FalconFelt::new(9153),
    FalconFelt::new(9273),
    FalconFelt::new(243),
    FalconFelt::new(3000),
    FalconFelt::new(671),
    FalconFelt::new(3531),
    FalconFelt::new(11813),
    FalconFelt::new(3985),
    FalconFelt::new(7384),
    FalconFelt::new(10111),
    FalconFelt::new(10745),
    FalconFelt::new(6730),
    FalconFelt::new(11869),
    FalconFelt::new(9042),
    FalconFelt::new(2686),
    FalconFelt::new(2969),
    FalconFelt::new(3978),
    FalconFelt::new(8779),
    FalconFelt::new(6957),
    FalconFelt::new(9424),
    FalconFelt::new(2370),
    FalconFelt::new(8241),
    FalconFelt::new(10040),
    FalconFelt::new(9405),
    FalconFelt::new(11136),
    FalconFelt::new(3186),
    FalconFelt::new(5407),
    FalconFelt::new(10163),
    FalconFelt::new(1630),
    FalconFelt::new(3271),
    FalconFelt::new(8232),
    FalconFelt::new(10600),
    FalconFelt::new(8925),
    FalconFelt::new(4414),
    FalconFelt::new(2847),
    FalconFelt::new(10115),
    FalconFelt::new(4372),
    FalconFelt::new(9509),
    FalconFelt::new(5195),
    FalconFelt::new(7394),
    FalconFelt::new(10805),
    FalconFelt::new(9984),
    FalconFelt::new(7247),
    FalconFelt::new(4053),
    FalconFelt::new(9644),
    FalconFelt::new(12176),
    FalconFelt::new(4919),
    FalconFelt::new(2166),
    FalconFelt::new(8374),
    FalconFelt::new(12129),
    FalconFelt::new(9140),
    FalconFelt::new(7852),
    FalconFelt::new(3),
    FalconFelt::new(1426),
    FalconFelt::new(7635),
    FalconFelt::new(10512),
    FalconFelt::new(1663),
    FalconFelt::new(8653),
    FalconFelt::new(4938),
    FalconFelt::new(2704),
    FalconFelt::new(5291),
    FalconFelt::new(5277),
    FalconFelt::new(1168),
    FalconFelt::new(11082),
    FalconFelt::new(9041),
    FalconFelt::new(2143),
    FalconFelt::new(11224),
    FalconFelt::new(11885),
    FalconFelt::new(4645),
    FalconFelt::new(4096),
    FalconFelt::new(11796),
    FalconFelt::new(5444),
    FalconFelt::new(2381),
    FalconFelt::new(10911),
    FalconFelt::new(1912),
    FalconFelt::new(4337),
    FalconFelt::new(11854),
    FalconFelt::new(4976),
    FalconFelt::new(10682),
    FalconFelt::new(11414),
    FalconFelt::new(8509),
    FalconFelt::new(11287),
    FalconFelt::new(5011),
    FalconFelt::new(8005),
    FalconFelt::new(5088),
    FalconFelt::new(9852),
    FalconFelt::new(8643),
    FalconFelt::new(9302),
    FalconFelt::new(6267),
    FalconFelt::new(2422),
    FalconFelt::new(6039),
    FalconFelt::new(2187),
    FalconFelt::new(2566),
    FalconFelt::new(10849),
    FalconFelt::new(8526),
    FalconFelt::new(9223),
    FalconFelt::new(27),
    FalconFelt::new(7205),
    FalconFelt::new(1632),
    FalconFelt::new(7404),
    FalconFelt::new(1017),
    FalconFelt::new(4143),
    FalconFelt::new(7575),
    FalconFelt::new(12047),
    FalconFelt::new(10752),
    FalconFelt::new(8585),
    FalconFelt::new(2678),
    FalconFelt::new(7270),
    FalconFelt::new(11744),
    FalconFelt::new(3833),
    FalconFelt::new(3778),
    FalconFelt::new(11899),
    FalconFelt::new(773),
    FalconFelt::new(5101),
    FalconFelt::new(11222),
    FalconFelt::new(9888),
    FalconFelt::new(442),
    FalconFelt::new(9377),
    FalconFelt::new(6591),
    FalconFelt::new(354),
    FalconFelt::new(7428),
    FalconFelt::new(5012),
    FalconFelt::new(2481),
    FalconFelt::new(1045),
    FalconFelt::new(9430),
    FalconFelt::new(10302),
    FalconFelt::new(10587),
    FalconFelt::new(8724),
    FalconFelt::new(11635),
    FalconFelt::new(7083),
    FalconFelt::new(5529),
    FalconFelt::new(9090),
    FalconFelt::new(12233),
    FalconFelt::new(6152),
    FalconFelt::new(4948),
    FalconFelt::new(400),
    FalconFelt::new(1728),
    FalconFelt::new(6427),
    FalconFelt::new(6136),
    FalconFelt::new(6874),
    FalconFelt::new(3643),
    FalconFelt::new(10930),
    FalconFelt::new(5435),
    FalconFelt::new(1254),
    FalconFelt::new(11316),
    FalconFelt::new(10256),
    FalconFelt::new(3998),
    FalconFelt::new(10367),
    FalconFelt::new(8410),
    FalconFelt::new(11821),
    FalconFelt::new(8301),
    FalconFelt::new(11907),
    FalconFelt::new(316),
    FalconFelt::new(6950),
    FalconFelt::new(5446),
    FalconFelt::new(6093),
    FalconFelt::new(3710),
    FalconFelt::new(7822),
    FalconFelt::new(4789),
    FalconFelt::new(7540),
    FalconFelt::new(5537),
    FalconFelt::new(3789),
    FalconFelt::new(147),
    FalconFelt::new(5456),
    FalconFelt::new(7840),
    FalconFelt::new(11239),
    FalconFelt::new(7753),
    FalconFelt::new(5445),
    FalconFelt::new(3860),
    FalconFelt::new(9606),
    FalconFelt::new(1190),
    FalconFelt::new(8471),
    FalconFelt::new(6118),
    FalconFelt::new(5925),
    FalconFelt::new(1018),
    FalconFelt::new(8775),
    FalconFelt::new(1041),
    FalconFelt::new(1973),
    FalconFelt::new(5574),
    FalconFelt::new(11011),
    FalconFelt::new(2344),
    FalconFelt::new(4075),
    FalconFelt::new(5315),
    FalconFelt::new(4324),
    FalconFelt::new(4916),
    FalconFelt::new(10120),
    FalconFelt::new(11767),
    FalconFelt::new(7210),
    FalconFelt::new(9027),
    FalconFelt::new(6281),
    FalconFelt::new(11404),
    FalconFelt::new(7280),
    FalconFelt::new(1956),
    FalconFelt::new(11286),
    FalconFelt::new(3532),
    FalconFelt::new(12048),
    FalconFelt::new(12231),
    FalconFelt::new(1105),
    FalconFelt::new(12147),
    FalconFelt::new(5681),
    FalconFelt::new(8812),
    FalconFelt::new(8851),
    FalconFelt::new(2844),
    FalconFelt::new(975),
    FalconFelt::new(4212),
    FalconFelt::new(8687),
    FalconFelt::new(6068),
    FalconFelt::new(421),
    FalconFelt::new(8209),
    FalconFelt::new(3600),
    FalconFelt::new(3263),
    FalconFelt::new(7665),
    FalconFelt::new(6077),
    FalconFelt::new(4782),
    FalconFelt::new(6403),
    FalconFelt::new(9260),
    FalconFelt::new(5594),
    FalconFelt::new(8076),
    FalconFelt::new(11785),
    FalconFelt::new(605),
    FalconFelt::new(9987),
    FalconFelt::new(5468),
    FalconFelt::new(1010),
    FalconFelt::new(787),
    FalconFelt::new(8807),
    FalconFelt::new(5241),
    FalconFelt::new(9369),
    FalconFelt::new(9162),
    FalconFelt::new(8120),
    FalconFelt::new(5057),
    FalconFelt::new(7591),
    FalconFelt::new(3445),
    FalconFelt::new(7509),
    FalconFelt::new(2049),
    FalconFelt::new(7377),
    FalconFelt::new(10968),
    FalconFelt::new(192),
    FalconFelt::new(431),
    FalconFelt::new(10710),
    FalconFelt::new(2505),
    FalconFelt::new(5906),
    FalconFelt::new(12138),
    FalconFelt::new(10162),
    FalconFelt::new(8332),
    FalconFelt::new(9450),
    FalconFelt::new(6415),
    FalconFelt::new(677),
    FalconFelt::new(6234),
    FalconFelt::new(3336),
    FalconFelt::new(12237),
    FalconFelt::new(9115),
    FalconFelt::new(1323),
    FalconFelt::new(2766),
    FalconFelt::new(3150),
    FalconFelt::new(1319),
    FalconFelt::new(8243),
    FalconFelt::new(709),
    FalconFelt::new(8049),
    FalconFelt::new(8719),
    FalconFelt::new(11454),
    FalconFelt::new(6224),
    FalconFelt::new(922),
    FalconFelt::new(11848),
    FalconFelt::new(8210),
    FalconFelt::new(1058),
    FalconFelt::new(1958),
    FalconFelt::new(7967),
    FalconFelt::new(10211),
    FalconFelt::new(11177),
    FalconFelt::new(64),
    FalconFelt::new(8633),
    FalconFelt::new(11606),
    FalconFelt::new(9830),
    FalconFelt::new(6507),
    FalconFelt::new(1566),
    FalconFelt::new(2948),
    FalconFelt::new(9786),
    FalconFelt::new(6370),
    FalconFelt::new(7856),
    FalconFelt::new(3834),
    FalconFelt::new(5257),
    FalconFelt::new(10542),
    FalconFelt::new(9166),
    FalconFelt::new(9235),
    FalconFelt::new(5486),
    FalconFelt::new(1404),
    FalconFelt::new(11964),
    FalconFelt::new(1146),
    FalconFelt::new(11341),
    FalconFelt::new(3728),
    FalconFelt::new(8240),
    FalconFelt::new(6299),
    FalconFelt::new(1159),
    FalconFelt::new(6099),
    FalconFelt::new(295),
    FalconFelt::new(5766),
    FalconFelt::new(11637),
    FalconFelt::new(8527),
    FalconFelt::new(2919),
    FalconFelt::new(8273),
    FalconFelt::new(8212),
    FalconFelt::new(3329),
    FalconFelt::new(7991),
    FalconFelt::new(9597),
    FalconFelt::new(168),
    FalconFelt::new(10695),
    FalconFelt::new(1962),
    FalconFelt::new(5106),
    FalconFelt::new(6328),
    FalconFelt::new(5297),
    FalconFelt::new(6170),
    FalconFelt::new(3956),
    FalconFelt::new(1360),
    FalconFelt::new(11089),
    FalconFelt::new(7105),
    FalconFelt::new(9734),
    FalconFelt::new(6167),
    FalconFelt::new(9407),
    FalconFelt::new(1805),
    FalconFelt::new(1954),
    FalconFelt::new(2051),
    FalconFelt::new(6142),
    FalconFelt::new(2447),
    FalconFelt::new(3963),
    FalconFelt::new(11713),
    FalconFelt::new(8855),
    FalconFelt::new(8760),
    FalconFelt::new(9381),
    FalconFelt::new(218),
    FalconFelt::new(9928),
    FalconFelt::new(10446),
    FalconFelt::new(9259),
    FalconFelt::new(4115),
    FalconFelt::new(5333),
    FalconFelt::new(10258),
    FalconFelt::new(5876),
    FalconFelt::new(2281),
    FalconFelt::new(156),
    FalconFelt::new(9522),
    FalconFelt::new(8320),
    FalconFelt::new(3991),
    FalconFelt::new(453),
    FalconFelt::new(6381),
    FalconFelt::new(11871),
    FalconFelt::new(8517),
    FalconFelt::new(4774),
    FalconFelt::new(6860),
    FalconFelt::new(4737),
    FalconFelt::new(1293),
    FalconFelt::new(10232),
    FalconFelt::new(5369),
    FalconFelt::new(9087),
    FalconFelt::new(7796),
    FalconFelt::new(350),
    FalconFelt::new(1512),
    FalconFelt::new(10474),
    FalconFelt::new(6906),
    FalconFelt::new(1489),
    FalconFelt::new(2500),
    FalconFelt::new(1583),
    FalconFelt::new(6347),
    FalconFelt::new(11026),
    FalconFelt::new(12240),
    FalconFelt::new(6374),
    FalconFelt::new(1483),
    FalconFelt::new(3009),
    FalconFelt::new(1693),
    FalconFelt::new(723),
    FalconFelt::new(174),
    FalconFelt::new(2738),
    FalconFelt::new(6421),
    FalconFelt::new(2655),
    FalconFelt::new(6554),
    FalconFelt::new(10314),
    FalconFelt::new(3757),
    FalconFelt::new(9364),
    FalconFelt::new(11942),
    FalconFelt::new(7535),
    FalconFelt::new(10431),
    FalconFelt::new(426),
    FalconFelt::new(3315),
];

const FELT_BITREVERSED_POWERS_INVERSE: [FalconFelt; 512] = [
    FalconFelt::new(1),
    FalconFelt::new(10810),
    FalconFelt::new(7143),
    FalconFelt::new(4043),
    FalconFelt::new(10984),
    FalconFelt::new(722),
    FalconFelt::new(5736),
    FalconFelt::new(8155),
    FalconFelt::new(8747),
    FalconFelt::new(3504),
    FalconFelt::new(2545),
    FalconFelt::new(8668),
    FalconFelt::new(1646),
    FalconFelt::new(11077),
    FalconFelt::new(9094),
    FalconFelt::new(6429),
    FalconFelt::new(9650),
    FalconFelt::new(7468),
    FalconFelt::new(949),
    FalconFelt::new(9664),
    FalconFelt::new(2975),
    FalconFelt::new(11726),
    FalconFelt::new(2744),
    FalconFelt::new(9283),
    FalconFelt::new(7698),
    FalconFelt::new(6561),
    FalconFelt::new(5828),
    FalconFelt::new(7266),
    FalconFelt::new(6512),
    FalconFelt::new(3328),
    FalconFelt::new(1351),
    FalconFelt::new(4978),
    FalconFelt::new(790),
    FalconFelt::new(11334),
    FalconFelt::new(2319),
    FalconFelt::new(11119),
    FalconFelt::new(1326),
    FalconFelt::new(5086),
    FalconFelt::new(9088),
    FalconFelt::new(3014),
    FalconFelt::new(3712),
    FalconFelt::new(3135),
    FalconFelt::new(7443),
    FalconFelt::new(2747),
    FalconFelt::new(9995),
    FalconFelt::new(1062),
    FalconFelt::new(7484),
    FalconFelt::new(3553),
    FalconFelt::new(4320),
    FalconFelt::new(1000),
    FalconFelt::new(81),
    FalconFelt::new(3091),
    FalconFelt::new(3051),
    FalconFelt::new(9923),
    FalconFelt::new(4896),
    FalconFelt::new(9326),
    FalconFelt::new(10654),
    FalconFelt::new(9521),
    FalconFelt::new(8034),
    FalconFelt::new(1177),
    FalconFelt::new(7678),
    FalconFelt::new(11563),
    FalconFelt::new(10436),
    FalconFelt::new(140),
    FalconFelt::new(1696),
    FalconFelt::new(10861),
    FalconFelt::new(9863),
    FalconFelt::new(11955),
    FalconFelt::new(11029),
    FalconFelt::new(7901),
    FalconFelt::new(7657),
    FalconFelt::new(5755),
    FalconFelt::new(2089),
    FalconFelt::new(7197),
    FalconFelt::new(2881),
    FalconFelt::new(3284),
    FalconFelt::new(2013),
    FalconFelt::new(9000),
    FalconFelt::new(729),
    FalconFelt::new(3241),
    FalconFelt::new(9741),
    FalconFelt::new(8058),
    FalconFelt::new(11934),
    FalconFelt::new(8907),
    FalconFelt::new(7110),
    FalconFelt::new(3694),
    FalconFelt::new(8582),
    FalconFelt::new(1759),
    FalconFelt::new(4890),
    FalconFelt::new(5911),
    FalconFelt::new(3932),
    FalconFelt::new(9558),
    FalconFelt::new(8830),
    FalconFelt::new(3637),
    FalconFelt::new(5542),
    FalconFelt::new(145),
    FalconFelt::new(339),
    FalconFelt::new(2468),
    FalconFelt::new(544),
    FalconFelt::new(6498),
    FalconFelt::new(9),
    FalconFelt::new(11267),
    FalconFelt::new(2842),
    FalconFelt::new(11809),
    FalconFelt::new(3584),
    FalconFelt::new(8112),
    FalconFelt::new(2525),
    FalconFelt::new(1381),
    FalconFelt::new(4989),
    FalconFelt::new(6958),
    FalconFelt::new(10616),
    FalconFelt::new(4278),
    FalconFelt::new(2476),
    FalconFelt::new(118),
    FalconFelt::new(2197),
    FalconFelt::new(7222),
    FalconFelt::new(827),
    FalconFelt::new(5767),
    FalconFelt::new(8541),
    FalconFelt::new(953),
    FalconFelt::new(4354),
    FalconFelt::new(12159),
    FalconFelt::new(9452),
    FalconFelt::new(5374),
    FalconFelt::new(7837),
    FalconFelt::new(9893),
    FalconFelt::new(3296),
    FalconFelt::new(3949),
    FalconFelt::new(2859),
    FalconFelt::new(11244),
    FalconFelt::new(9808),
    FalconFelt::new(7277),
    FalconFelt::new(4861),
    FalconFelt::new(11935),
    FalconFelt::new(5698),
    FalconFelt::new(2912),
    FalconFelt::new(11847),
    FalconFelt::new(2401),
    FalconFelt::new(1067),
    FalconFelt::new(7188),
    FalconFelt::new(11516),
    FalconFelt::new(390),
    FalconFelt::new(8511),
    FalconFelt::new(8456),
    FalconFelt::new(545),
    FalconFelt::new(5019),
    FalconFelt::new(9611),
    FalconFelt::new(3704),
    FalconFelt::new(1537),
    FalconFelt::new(242),
    FalconFelt::new(4714),
    FalconFelt::new(8146),
    FalconFelt::new(11272),
    FalconFelt::new(4885),
    FalconFelt::new(10657),
    FalconFelt::new(5084),
    FalconFelt::new(12262),
    FalconFelt::new(3066),
    FalconFelt::new(3763),
    FalconFelt::new(1440),
    FalconFelt::new(9723),
    FalconFelt::new(10102),
    FalconFelt::new(6250),
    FalconFelt::new(9867),
    FalconFelt::new(6022),
    FalconFelt::new(2987),
    FalconFelt::new(3646),
    FalconFelt::new(2437),
    FalconFelt::new(7201),
    FalconFelt::new(4284),
    FalconFelt::new(7278),
    FalconFelt::new(1002),
    FalconFelt::new(3780),
    FalconFelt::new(875),
    FalconFelt::new(1607),
    FalconFelt::new(7313),
    FalconFelt::new(435),
    FalconFelt::new(7952),
    FalconFelt::new(10377),
    FalconFelt::new(1378),
    FalconFelt::new(9908),
    FalconFelt::new(6845),
    FalconFelt::new(493),
    FalconFelt::new(8193),
    FalconFelt::new(7644),
    FalconFelt::new(404),
    FalconFelt::new(1065),
    FalconFelt::new(10146),
    FalconFelt::new(3248),
    FalconFelt::new(1207),
    FalconFelt::new(11121),
    FalconFelt::new(7012),
    FalconFelt::new(6998),
    FalconFelt::new(9585),
    FalconFelt::new(7351),
    FalconFelt::new(3636),
    FalconFelt::new(10626),
    FalconFelt::new(1777),
    FalconFelt::new(4654),
    FalconFelt::new(10863),
    FalconFelt::new(12286),
    FalconFelt::new(4437),
    FalconFelt::new(3149),
    FalconFelt::new(160),
    FalconFelt::new(3915),
    FalconFelt::new(10123),
    FalconFelt::new(7370),
    FalconFelt::new(113),
    FalconFelt::new(2645),
    FalconFelt::new(8236),
    FalconFelt::new(5042),
    FalconFelt::new(2305),
    FalconFelt::new(1484),
    FalconFelt::new(4895),
    FalconFelt::new(7094),
    FalconFelt::new(2780),
    FalconFelt::new(7917),
    FalconFelt::new(2174),
    FalconFelt::new(9442),
    FalconFelt::new(7875),
    FalconFelt::new(3364),
    FalconFelt::new(1689),
    FalconFelt::new(4057),
    FalconFelt::new(9018),
    FalconFelt::new(10659),
    FalconFelt::new(2126),
    FalconFelt::new(6882),
    FalconFelt::new(9103),
    FalconFelt::new(1153),
    FalconFelt::new(2884),
    FalconFelt::new(2249),
    FalconFelt::new(4048),
    FalconFelt::new(9919),
    FalconFelt::new(2865),
    FalconFelt::new(5332),
    FalconFelt::new(3510),
    FalconFelt::new(8311),
    FalconFelt::new(9320),
    FalconFelt::new(9603),
    FalconFelt::new(3247),
    FalconFelt::new(420),
    FalconFelt::new(5559),
    FalconFelt::new(1544),
    FalconFelt::new(2178),
    FalconFelt::new(4905),
    FalconFelt::new(8304),
    FalconFelt::new(476),
    FalconFelt::new(8758),
    FalconFelt::new(11618),
    FalconFelt::new(9289),
    FalconFelt::new(12046),
    FalconFelt::new(3016),
    FalconFelt::new(3136),
    FalconFelt::new(7098),
    FalconFelt::new(9890),
    FalconFelt::new(8889),
    FalconFelt::new(8974),
    FalconFelt::new(11863),
    FalconFelt::new(1858),
    FalconFelt::new(4754),
    FalconFelt::new(347),
    FalconFelt::new(2925),
    FalconFelt::new(8532),
    FalconFelt::new(1975),
    FalconFelt::new(5735),
    FalconFelt::new(9634),
    FalconFelt::new(5868),
    FalconFelt::new(9551),
    FalconFelt::new(12115),
    FalconFelt::new(11566),
    FalconFelt::new(10596),
    FalconFelt::new(9280),
    FalconFelt::new(10806),
    FalconFelt::new(5915),
    FalconFelt::new(49),
    FalconFelt::new(1263),
    FalconFelt::new(5942),
    FalconFelt::new(10706),
    FalconFelt::new(9789),
    FalconFelt::new(10800),
    FalconFelt::new(5383),
    FalconFelt::new(1815),
    FalconFelt::new(10777),
    FalconFelt::new(11939),
    FalconFelt::new(4493),
    FalconFelt::new(3202),
    FalconFelt::new(6920),
    FalconFelt::new(2057),
    FalconFelt::new(10996),
    FalconFelt::new(7552),
    FalconFelt::new(5429),
    FalconFelt::new(7515),
    FalconFelt::new(3772),
    FalconFelt::new(418),
    FalconFelt::new(5908),
    FalconFelt::new(11836),
    FalconFelt::new(8298),
    FalconFelt::new(3969),
    FalconFelt::new(2767),
    FalconFelt::new(12133),
    FalconFelt::new(10008),
    FalconFelt::new(6413),
    FalconFelt::new(2031),
    FalconFelt::new(6956),
    FalconFelt::new(8174),
    FalconFelt::new(3030),
    FalconFelt::new(1843),
    FalconFelt::new(2361),
    FalconFelt::new(12071),
    FalconFelt::new(2908),
    FalconFelt::new(3529),
    FalconFelt::new(3434),
    FalconFelt::new(576),
    FalconFelt::new(8326),
    FalconFelt::new(9842),
    FalconFelt::new(6147),
    FalconFelt::new(10238),
    FalconFelt::new(10335),
    FalconFelt::new(10484),
    FalconFelt::new(2882),
    FalconFelt::new(6122),
    FalconFelt::new(2555),
    FalconFelt::new(5184),
    FalconFelt::new(1200),
    FalconFelt::new(10929),
    FalconFelt::new(8333),
    FalconFelt::new(6119),
    FalconFelt::new(6992),
    FalconFelt::new(5961),
    FalconFelt::new(7183),
    FalconFelt::new(10327),
    FalconFelt::new(1594),
    FalconFelt::new(12121),
    FalconFelt::new(2692),
    FalconFelt::new(4298),
    FalconFelt::new(8960),
    FalconFelt::new(4077),
    FalconFelt::new(4016),
    FalconFelt::new(9370),
    FalconFelt::new(3762),
    FalconFelt::new(652),
    FalconFelt::new(6523),
    FalconFelt::new(11994),
    FalconFelt::new(6190),
    FalconFelt::new(11130),
    FalconFelt::new(5990),
    FalconFelt::new(4049),
    FalconFelt::new(8561),
    FalconFelt::new(948),
    FalconFelt::new(11143),
    FalconFelt::new(325),
    FalconFelt::new(10885),
    FalconFelt::new(6803),
    FalconFelt::new(3054),
    FalconFelt::new(3123),
    FalconFelt::new(1747),
    FalconFelt::new(7032),
    FalconFelt::new(8455),
    FalconFelt::new(4433),
    FalconFelt::new(5919),
    FalconFelt::new(2503),
    FalconFelt::new(9341),
    FalconFelt::new(10723),
    FalconFelt::new(5782),
    FalconFelt::new(2459),
    FalconFelt::new(683),
    FalconFelt::new(3656),
    FalconFelt::new(12225),
    FalconFelt::new(1112),
    FalconFelt::new(2078),
    FalconFelt::new(4322),
    FalconFelt::new(10331),
    FalconFelt::new(11231),
    FalconFelt::new(4079),
    FalconFelt::new(441),
    FalconFelt::new(11367),
    FalconFelt::new(6065),
    FalconFelt::new(835),
    FalconFelt::new(3570),
    FalconFelt::new(4240),
    FalconFelt::new(11580),
    FalconFelt::new(4046),
    FalconFelt::new(10970),
    FalconFelt::new(9139),
    FalconFelt::new(9523),
    FalconFelt::new(10966),
    FalconFelt::new(3174),
    FalconFelt::new(52),
    FalconFelt::new(8953),
    FalconFelt::new(6055),
    FalconFelt::new(11612),
    FalconFelt::new(5874),
    FalconFelt::new(2839),
    FalconFelt::new(3957),
    FalconFelt::new(2127),
    FalconFelt::new(151),
    FalconFelt::new(6383),
    FalconFelt::new(9784),
    FalconFelt::new(1579),
    FalconFelt::new(11858),
    FalconFelt::new(12097),
    FalconFelt::new(1321),
    FalconFelt::new(4912),
    FalconFelt::new(10240),
    FalconFelt::new(4780),
    FalconFelt::new(8844),
    FalconFelt::new(4698),
    FalconFelt::new(7232),
    FalconFelt::new(4169),
    FalconFelt::new(3127),
    FalconFelt::new(2920),
    FalconFelt::new(7048),
    FalconFelt::new(3482),
    FalconFelt::new(11502),
    FalconFelt::new(11279),
    FalconFelt::new(6821),
    FalconFelt::new(2302),
    FalconFelt::new(11684),
    FalconFelt::new(504),
    FalconFelt::new(4213),
    FalconFelt::new(6695),
    FalconFelt::new(3029),
    FalconFelt::new(5886),
    FalconFelt::new(7507),
    FalconFelt::new(6212),
    FalconFelt::new(4624),
    FalconFelt::new(9026),
    FalconFelt::new(8689),
    FalconFelt::new(4080),
    FalconFelt::new(11868),
    FalconFelt::new(6221),
    FalconFelt::new(3602),
    FalconFelt::new(8077),
    FalconFelt::new(11314),
    FalconFelt::new(9445),
    FalconFelt::new(3438),
    FalconFelt::new(3477),
    FalconFelt::new(6608),
    FalconFelt::new(142),
    FalconFelt::new(11184),
    FalconFelt::new(58),
    FalconFelt::new(241),
    FalconFelt::new(8757),
    FalconFelt::new(1003),
    FalconFelt::new(10333),
    FalconFelt::new(5009),
    FalconFelt::new(885),
    FalconFelt::new(6008),
    FalconFelt::new(3262),
    FalconFelt::new(5079),
    FalconFelt::new(522),
    FalconFelt::new(2169),
    FalconFelt::new(7373),
    FalconFelt::new(7965),
    FalconFelt::new(6974),
    FalconFelt::new(8214),
    FalconFelt::new(9945),
    FalconFelt::new(1278),
    FalconFelt::new(6715),
    FalconFelt::new(10316),
    FalconFelt::new(11248),
    FalconFelt::new(3514),
    FalconFelt::new(11271),
    FalconFelt::new(6364),
    FalconFelt::new(6171),
    FalconFelt::new(3818),
    FalconFelt::new(11099),
    FalconFelt::new(2683),
    FalconFelt::new(8429),
    FalconFelt::new(6844),
    FalconFelt::new(4536),
    FalconFelt::new(1050),
    FalconFelt::new(4449),
    FalconFelt::new(6833),
    FalconFelt::new(12142),
    FalconFelt::new(8500),
    FalconFelt::new(6752),
    FalconFelt::new(4749),
    FalconFelt::new(7500),
    FalconFelt::new(4467),
    FalconFelt::new(8579),
    FalconFelt::new(6196),
    FalconFelt::new(6843),
    FalconFelt::new(5339),
    FalconFelt::new(11973),
    FalconFelt::new(382),
    FalconFelt::new(3988),
    FalconFelt::new(468),
    FalconFelt::new(3879),
    FalconFelt::new(1922),
    FalconFelt::new(8291),
    FalconFelt::new(2033),
    FalconFelt::new(973),
    FalconFelt::new(11035),
    FalconFelt::new(6854),
    FalconFelt::new(1359),
    FalconFelt::new(8646),
    FalconFelt::new(5415),
    FalconFelt::new(6153),
    FalconFelt::new(5862),
    FalconFelt::new(10561),
    FalconFelt::new(11889),
    FalconFelt::new(7341),
    FalconFelt::new(6137),
    FalconFelt::new(56),
    FalconFelt::new(3199),
    FalconFelt::new(6760),
    FalconFelt::new(5206),
    FalconFelt::new(654),
    FalconFelt::new(3565),
    FalconFelt::new(1702),
    FalconFelt::new(1987),
];

const FELT_NINV_1: FalconFelt = FalconFelt::new(1);
const FELT_NINV_2: FalconFelt = FalconFelt::new(6145);
const FELT_NINV_4: FalconFelt = FalconFelt::new(9217);
const FELT_NINV_8: FalconFelt = FalconFelt::new(10753);
const FELT_NINV_16: FalconFelt = FalconFelt::new(11521);
const FELT_NINV_32: FalconFelt = FalconFelt::new(11905);
const FELT_NINV_64: FalconFelt = FalconFelt::new(12097);
const FELT_NINV_128: FalconFelt = FalconFelt::new(12193);
const FELT_NINV_256: FalconFelt = FalconFelt::new(12241);
const FELT_NINV_512: FalconFelt = FalconFelt::new(12265);
