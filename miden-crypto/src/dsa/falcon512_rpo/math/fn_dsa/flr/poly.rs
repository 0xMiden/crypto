//! FLR-based polynomial operations for Falcon512 signing.
//!
//! This module contains optimized fixed-point arithmetic operations ported from fn-dsa-sign.
//! All operations use FLR (Fixed-point Linear Real) types instead of native f64.
//!
//! Key functions:
//! - `FFT()` / `iFFT()`: Forward and inverse FFT transforms (with AVX2 dispatch on x86_64)
//! - `poly_set_small()`: Convert small integer coefficients to FLR
//! - `poly_add()`, `poly_sub()`, `poly_mul_fft()`: Polynomial arithmetic
//! - `poly_split_fft()`, `poly_merge_fft()`: Split/merge for recursive sampling

#![allow(clippy::excessive_precision)] // Precision needed for FLR accuracy
#![allow(clippy::needless_borrow)] // Match fn-dsa style
#![allow(clippy::double_parens)] // Match fn-dsa style
#![allow(clippy::unnecessary_cast)] // Match fn-dsa style
#![allow(clippy::useless_transmute)] // Match fn-dsa style
#![allow(clippy::needless_range_loop)] // Match fn-dsa style
//!
//! On x86_64 with AVX2 support, functions automatically dispatch to AVX2-accelerated versions
//! for 2x wider SIMD parallelism (256-bit vs 128-bit).
//!
//! Source: rust-fn-dsa (https://github.com/pornin/rust-fn-dsa)

#![allow(non_snake_case)]
#![allow(dead_code)]

use super::FLR;
#[cfg(target_arch = "x86_64")]
use super::poly_avx2;
#[cfg(target_arch = "x86_64")]
use std::is_x86_feature_detected;

// ========================================================================
// Complex multiplication for FLR
// ========================================================================

#[inline(always)]
pub(crate) fn flc_mul(x_re: &FLR, x_im: &FLR, y_re: &FLR, y_im: &FLR) -> (FLR, FLR) {
    (x_re * y_re - x_im * y_im, x_re * y_im + x_im * y_re)
}

const fn mkflr(x: i64, sc: i32) -> FLR {
    FLR::scaled(x, sc)
}
pub(crate) const GM: [FLR; 2048] = [
    FLR::ZERO,
    FLR::ZERO,
    FLR::NZERO,
    FLR::ONE,
    mkflr(6369051672525773, -53),
    mkflr(6369051672525773, -53),
    mkflr(-6369051672525773, -53),
    mkflr(6369051672525773, -53),
    mkflr(8321567036706118, -53),
    mkflr(6893811853601123, -54),
    mkflr(-6893811853601123, -54),
    mkflr(8321567036706118, -53),
    mkflr(6893811853601123, -54),
    mkflr(8321567036706118, -53),
    mkflr(-8321567036706118, -53),
    mkflr(6893811853601123, -54),
    mkflr(8834128446708912, -53),
    mkflr(7028869612283403, -55),
    mkflr(-7028869612283403, -55),
    mkflr(8834128446708912, -53),
    mkflr(5004131788810440, -53),
    mkflr(7489212472271267, -53),
    mkflr(-7489212472271267, -53),
    mkflr(5004131788810440, -53),
    mkflr(7489212472271267, -53),
    mkflr(5004131788810440, -53),
    mkflr(-5004131788810440, -53),
    mkflr(7489212472271267, -53),
    mkflr(7028869612283403, -55),
    mkflr(8834128446708912, -53),
    mkflr(-8834128446708912, -53),
    mkflr(7028869612283403, -55),
    mkflr(8963827128411430, -53),
    mkflr(7062879306626092, -56),
    mkflr(-7062879306626092, -56),
    mkflr(8963827128411430, -53),
    mkflr(5714106716331478, -53),
    mkflr(6962659179435841, -53),
    mkflr(-6962659179435841, -53),
    mkflr(5714106716331478, -53),
    mkflr(7943640554978737, -53),
    mkflr(8491928673252923, -54),
    mkflr(-8491928673252923, -54),
    mkflr(7943640554978737, -53),
    mkflr(5229303857258246, -54),
    mkflr(8619352278838746, -53),
    mkflr(-8619352278838746, -53),
    mkflr(5229303857258246, -54),
    mkflr(8619352278838746, -53),
    mkflr(5229303857258246, -54),
    mkflr(-5229303857258246, -54),
    mkflr(8619352278838746, -53),
    mkflr(8491928673252923, -54),
    mkflr(7943640554978737, -53),
    mkflr(-7943640554978737, -53),
    mkflr(8491928673252923, -54),
    mkflr(6962659179435841, -53),
    mkflr(5714106716331478, -53),
    mkflr(-5714106716331478, -53),
    mkflr(6962659179435841, -53),
    mkflr(7062879306626092, -56),
    mkflr(8963827128411430, -53),
    mkflr(-8963827128411430, -53),
    mkflr(7062879306626092, -56),
    mkflr(8996349688769918, -53),
    mkflr(7071397114140692, -57),
    mkflr(-7071397114140692, -57),
    mkflr(8996349688769918, -53),
    mkflr(6048865317612704, -53),
    mkflr(6673894424096687, -53),
    mkflr(-6673894424096687, -53),
    mkflr(6048865317612704, -53),
    mkflr(8142411687315315, -53),
    mkflr(7702147837811904, -54),
    mkflr(-7702147837811904, -54),
    mkflr(8142411687315315, -53),
    mkflr(6068868072808413, -54),
    mkflr(8480675002222309, -53),
    mkflr(-8480675002222309, -53),
    mkflr(6068868072808413, -54),
    mkflr(8737264780849367, -53),
    mkflr(8754283581366043, -55),
    mkflr(-8754283581366043, -55),
    mkflr(8737264780849367, -53),
    mkflr(4630625854357486, -53),
    mkflr(7725732496764478, -53),
    mkflr(-7725732496764478, -53),
    mkflr(4630625854357486, -53),
    mkflr(7234650278954817, -53),
    mkflr(5365582331473973, -53),
    mkflr(-5365582331473973, -53),
    mkflr(7234650278954817, -53),
    mkflr(5286522480648506, -55),
    mkflr(8909709923362071, -53),
    mkflr(-8909709923362071, -53),
    mkflr(5286522480648506, -55),
    mkflr(8909709923362071, -53),
    mkflr(5286522480648506, -55),
    mkflr(-5286522480648506, -55),
    mkflr(8909709923362071, -53),
    mkflr(5365582331473973, -53),
    mkflr(7234650278954817, -53),
    mkflr(-7234650278954817, -53),
    mkflr(5365582331473973, -53),
    mkflr(7725732496764478, -53),
    mkflr(4630625854357486, -53),
    mkflr(-4630625854357486, -53),
    mkflr(7725732496764478, -53),
    mkflr(8754283581366043, -55),
    mkflr(8737264780849367, -53),
    mkflr(-8737264780849367, -53),
    mkflr(8754283581366043, -55),
    mkflr(8480675002222309, -53),
    mkflr(6068868072808413, -54),
    mkflr(-6068868072808413, -54),
    mkflr(8480675002222309, -53),
    mkflr(7702147837811904, -54),
    mkflr(8142411687315315, -53),
    mkflr(-8142411687315315, -53),
    mkflr(7702147837811904, -54),
    mkflr(6673894424096687, -53),
    mkflr(6048865317612704, -53),
    mkflr(-6048865317612704, -53),
    mkflr(6673894424096687, -53),
    mkflr(7071397114140692, -57),
    mkflr(8996349688769918, -53),
    mkflr(-8996349688769918, -53),
    mkflr(7071397114140692, -57),
    mkflr(9004486454725901, -53),
    mkflr(7073527528384126, -58),
    mkflr(-7073527528384126, -58),
    mkflr(9004486454725901, -53),
    mkflr(6210829080669407, -53),
    mkflr(6523437785808790, -53),
    mkflr(-6523437785808790, -53),
    mkflr(6210829080669407, -53),
    mkflr(8234469430249786, -53),
    mkflr(7300178522992010, -54),
    mkflr(-7300178522992010, -54),
    mkflr(8234469430249786, -53),
    mkflr(6483292609725855, -54),
    mkflr(8403652042342972, -53),
    mkflr(-8403652042342972, -53),
    mkflr(6483292609725855, -54),
    mkflr(8788343498532233, -53),
    mkflr(7893954108215139, -55),
    mkflr(-7893954108215139, -55),
    mkflr(8788343498532233, -53),
    mkflr(4818830163135267, -53),
    mkflr(7609764403282432, -53),
    mkflr(-7609764403282432, -53),
    mkflr(4818830163135267, -53),
    mkflr(7364149319706498, -53),
    mkflr(5186419112612575, -53),
    mkflr(-5186419112612575, -53),
    mkflr(7364149319706498, -53),
    mkflr(6159551188123590, -55),
    mkflr(8874592046238633, -53),
    mkflr(-8874592046238633, -53),
    mkflr(6159551188123590, -55),
    mkflr(8939460924383187, -53),
    mkflr(8820618739413774, -56),
    mkflr(-8820618739413774, -56),
    mkflr(8939460924383187, -53),
    mkflr(5541513524170937, -53),
    mkflr(7100793355396091, -53),
    mkflr(-7100793355396091, -53),
    mkflr(5541513524170937, -53),
    mkflr(7837046897874218, -53),
    mkflr(8879264459430586, -54),
    mkflr(-8879264459430586, -54),
    mkflr(7837046897874218, -53),
    mkflr(4804669900715639, -54),
    mkflr(8680923061569891, -53),
    mkflr(-8680923061569891, -53),
    mkflr(4804669900715639, -54),
    mkflr(8552589520593170, -53),
    mkflr(5650787876693505, -54),
    mkflr(-5650787876693505, -54),
    mkflr(8552589520593170, -53),
    mkflr(8099477666776158, -54),
    mkflr(8045449260044789, -53),
    mkflr(-8045449260044789, -53),
    mkflr(8099477666776158, -54),
    mkflr(6820330957936494, -53),
    mkflr(5883257944270313, -53),
    mkflr(-5883257944270313, -53),
    mkflr(6820330957936494, -53),
    mkflr(5300885459442166, -56),
    mkflr(8982793858156602, -53),
    mkflr(-8982793858156602, -53),
    mkflr(5300885459442166, -56),
    mkflr(8982793858156602, -53),
    mkflr(5300885459442166, -56),
    mkflr(-5300885459442166, -56),
    mkflr(8982793858156602, -53),
    mkflr(5883257944270313, -53),
    mkflr(6820330957936494, -53),
    mkflr(-6820330957936494, -53),
    mkflr(5883257944270313, -53),
    mkflr(8045449260044789, -53),
    mkflr(8099477666776158, -54),
    mkflr(-8099477666776158, -54),
    mkflr(8045449260044789, -53),
    mkflr(5650787876693505, -54),
    mkflr(8552589520593170, -53),
    mkflr(-8552589520593170, -53),
    mkflr(5650787876693505, -54),
    mkflr(8680923061569891, -53),
    mkflr(4804669900715639, -54),
    mkflr(-4804669900715639, -54),
    mkflr(8680923061569891, -53),
    mkflr(8879264459430586, -54),
    mkflr(7837046897874218, -53),
    mkflr(-7837046897874218, -53),
    mkflr(8879264459430586, -54),
    mkflr(7100793355396091, -53),
    mkflr(5541513524170937, -53),
    mkflr(-5541513524170937, -53),
    mkflr(7100793355396091, -53),
    mkflr(8820618739413774, -56),
    mkflr(8939460924383187, -53),
    mkflr(-8939460924383187, -53),
    mkflr(8820618739413774, -56),
    mkflr(8874592046238633, -53),
    mkflr(6159551188123590, -55),
    mkflr(-6159551188123590, -55),
    mkflr(8874592046238633, -53),
    mkflr(5186419112612575, -53),
    mkflr(7364149319706498, -53),
    mkflr(-7364149319706498, -53),
    mkflr(5186419112612575, -53),
    mkflr(7609764403282432, -53),
    mkflr(4818830163135267, -53),
    mkflr(-4818830163135267, -53),
    mkflr(7609764403282432, -53),
    mkflr(7893954108215139, -55),
    mkflr(8788343498532233, -53),
    mkflr(-8788343498532233, -53),
    mkflr(7893954108215139, -55),
    mkflr(8403652042342972, -53),
    mkflr(6483292609725855, -54),
    mkflr(-6483292609725855, -54),
    mkflr(8403652042342972, -53),
    mkflr(7300178522992010, -54),
    mkflr(8234469430249786, -53),
    mkflr(-8234469430249786, -53),
    mkflr(7300178522992010, -54),
    mkflr(6523437785808790, -53),
    mkflr(6210829080669407, -53),
    mkflr(-6210829080669407, -53),
    mkflr(6523437785808790, -53),
    mkflr(7073527528384126, -58),
    mkflr(9004486454725901, -53),
    mkflr(-9004486454725901, -53),
    mkflr(7073527528384126, -58),
    mkflr(9006521029202651, -53),
    mkflr(7074060192106372, -59),
    mkflr(-7074060192106372, -59),
    mkflr(9006521029202651, -53),
    mkflr(6290414033205309, -53),
    mkflr(6446730156091567, -53),
    mkflr(-6446730156091567, -53),
    mkflr(6290414033205309, -53),
    mkflr(8278641599964811, -53),
    mkflr(7097529619223511, -54),
    mkflr(-7097529619223511, -54),
    mkflr(8278641599964811, -53),
    mkflr(6689055905271015, -54),
    mkflr(8363239276060827, -53),
    mkflr(-8363239276060827, -53),
    mkflr(6689055905271015, -54),
    mkflr(8811899492445997, -53),
    mkflr(7461973733147729, -55),
    mkflr(-7461973733147729, -55),
    mkflr(8811899492445997, -53),
    mkflr(4911850829306697, -53),
    mkflr(7550056943179025, -53),
    mkflr(-7550056943179025, -53),
    mkflr(4911850829306697, -53),
    mkflr(7427240153512674, -53),
    mkflr(5095659144473433, -53),
    mkflr(-5095659144473433, -53),
    mkflr(7427240153512674, -53),
    mkflr(6594706969509681, -55),
    mkflr(8855027013722231, -53),
    mkflr(-8855027013722231, -53),
    mkflr(6594706969509681, -55),
    mkflr(8952318119487099, -53),
    mkflr(7942347067146965, -56),
    mkflr(-7942347067146965, -56),
    mkflr(8952318119487099, -53),
    mkflr(5628233915913940, -53),
    mkflr(7032255783343117, -53),
    mkflr(-7032255783343117, -53),
    mkflr(5628233915913940, -53),
    mkflr(7890937899537737, -53),
    mkflr(8686250625038550, -54),
    mkflr(-8686250625038550, -54),
    mkflr(7890937899537737, -53),
    mkflr(5017364677319486, -54),
    mkflr(8650789058710388, -53),
    mkflr(-8650789058710388, -53),
    mkflr(5017364677319486, -54),
    mkflr(8586617456218381, -53),
    mkflr(5440455523270994, -54),
    mkflr(-5440455523270994, -54),
    mkflr(8586617456218381, -53),
    mkflr(8296327868244873, -54),
    mkflr(7995146927371163, -53),
    mkflr(-7995146927371163, -53),
    mkflr(8296327868244873, -54),
    mkflr(6892014024666815, -53),
    mkflr(5799118993295673, -53),
    mkflr(-5799118993295673, -53),
    mkflr(6892014024666815, -53),
    mkflr(6182347902460953, -56),
    mkflr(8973986217941769, -53),
    mkflr(-8973986217941769, -53),
    mkflr(6182347902460953, -56),
    mkflr(8990248722657709, -53),
    mkflr(8837249445142752, -57),
    mkflr(-8837249445142752, -57),
    mkflr(8990248722657709, -53),
    mkflr(5966510898238870, -53),
    mkflr(6747620774451057, -53),
    mkflr(-6747620774451057, -53),
    mkflr(5966510898238870, -53),
    mkflr(8094539977653340, -53),
    mkflr(7901407713763047, -54),
    mkflr(-7901407713763047, -54),
    mkflr(8094539977653340, -53),
    mkflr(5860269242247018, -54),
    mkflr(8517273596445054, -53),
    mkflr(-8517273596445054, -53),
    mkflr(5860269242247018, -54),
    mkflr(8709749749347266, -53),
    mkflr(4591251558497710, -54),
    mkflr(-4591251558497710, -54),
    mkflr(8709749749347266, -53),
    mkflr(4535470554627767, -53),
    mkflr(7781975665774802, -53),
    mkflr(-7781975665774802, -53),
    mkflr(4535470554627767, -53),
    mkflr(7168261574088514, -53),
    mkflr(5453958600874483, -53),
    mkflr(-5453958600874483, -53),
    mkflr(7168261574088514, -53),
    mkflr(4848781029471607, -55),
    mkflr(8925257479345985, -53),
    mkflr(-8925257479345985, -53),
    mkflr(4848781029471607, -55),
    mkflr(8892820597836187, -53),
    mkflr(5723467800985178, -55),
    mkflr(-5723467800985178, -55),
    mkflr(8892820597836187, -53),
    mkflr(5276398025110506, -53),
    mkflr(7299949472100244, -53),
    mkflr(-7299949472100244, -53),
    mkflr(5276398025110506, -53),
    mkflr(7668325860857618, -53),
    mkflr(4725083798866319, -53),
    mkflr(-4725083798866319, -53),
    mkflr(7668325860857618, -53),
    mkflr(8324745682830097, -55),
    mkflr(8763464012413658, -53),
    mkflr(-8763464012413658, -53),
    mkflr(8324745682830097, -55),
    mkflr(8442799249538603, -53),
    mkflr(6276552954161094, -54),
    mkflr(-6276552954161094, -54),
    mkflr(8442799249538603, -53),
    mkflr(7501728046727114, -54),
    mkflr(8189057179727324, -53),
    mkflr(-8189057179727324, -53),
    mkflr(7501728046727114, -54),
    mkflr(6599163009790561, -53),
    mkflr(6130308800119180, -53),
    mkflr(-6130308800119180, -53),
    mkflr(6599163009790561, -53),
    mkflr(5304479856743885, -57),
    mkflr(9001095837710173, -53),
    mkflr(-9001095837710173, -53),
    mkflr(5304479856743885, -57),
    mkflr(9001095837710173, -53),
    mkflr(5304479856743885, -57),
    mkflr(-5304479856743885, -57),
    mkflr(9001095837710173, -53),
    mkflr(6130308800119180, -53),
    mkflr(6599163009790561, -53),
    mkflr(-6599163009790561, -53),
    mkflr(6130308800119180, -53),
    mkflr(8189057179727324, -53),
    mkflr(7501728046727114, -54),
    mkflr(-7501728046727114, -54),
    mkflr(8189057179727324, -53),
    mkflr(6276552954161094, -54),
    mkflr(8442799249538603, -53),
    mkflr(-8442799249538603, -53),
    mkflr(6276552954161094, -54),
    mkflr(8763464012413658, -53),
    mkflr(8324745682830097, -55),
    mkflr(-8324745682830097, -55),
    mkflr(8763464012413658, -53),
    mkflr(4725083798866319, -53),
    mkflr(7668325860857618, -53),
    mkflr(-7668325860857618, -53),
    mkflr(4725083798866319, -53),
    mkflr(7299949472100244, -53),
    mkflr(5276398025110506, -53),
    mkflr(-5276398025110506, -53),
    mkflr(7299949472100244, -53),
    mkflr(5723467800985178, -55),
    mkflr(8892820597836187, -53),
    mkflr(-8892820597836187, -53),
    mkflr(5723467800985178, -55),
    mkflr(8925257479345985, -53),
    mkflr(4848781029471607, -55),
    mkflr(-4848781029471607, -55),
    mkflr(8925257479345985, -53),
    mkflr(5453958600874483, -53),
    mkflr(7168261574088514, -53),
    mkflr(-7168261574088514, -53),
    mkflr(5453958600874483, -53),
    mkflr(7781975665774802, -53),
    mkflr(4535470554627767, -53),
    mkflr(-4535470554627767, -53),
    mkflr(7781975665774802, -53),
    mkflr(4591251558497710, -54),
    mkflr(8709749749347266, -53),
    mkflr(-8709749749347266, -53),
    mkflr(4591251558497710, -54),
    mkflr(8517273596445054, -53),
    mkflr(5860269242247018, -54),
    mkflr(-5860269242247018, -54),
    mkflr(8517273596445054, -53),
    mkflr(7901407713763047, -54),
    mkflr(8094539977653340, -53),
    mkflr(-8094539977653340, -53),
    mkflr(7901407713763047, -54),
    mkflr(6747620774451057, -53),
    mkflr(5966510898238870, -53),
    mkflr(-5966510898238870, -53),
    mkflr(6747620774451057, -53),
    mkflr(8837249445142752, -57),
    mkflr(8990248722657709, -53),
    mkflr(-8990248722657709, -53),
    mkflr(8837249445142752, -57),
    mkflr(8973986217941769, -53),
    mkflr(6182347902460953, -56),
    mkflr(-6182347902460953, -56),
    mkflr(8973986217941769, -53),
    mkflr(5799118993295673, -53),
    mkflr(6892014024666815, -53),
    mkflr(-6892014024666815, -53),
    mkflr(5799118993295673, -53),
    mkflr(7995146927371163, -53),
    mkflr(8296327868244873, -54),
    mkflr(-8296327868244873, -54),
    mkflr(7995146927371163, -53),
    mkflr(5440455523270994, -54),
    mkflr(8586617456218381, -53),
    mkflr(-8586617456218381, -53),
    mkflr(5440455523270994, -54),
    mkflr(8650789058710388, -53),
    mkflr(5017364677319486, -54),
    mkflr(-5017364677319486, -54),
    mkflr(8650789058710388, -53),
    mkflr(8686250625038550, -54),
    mkflr(7890937899537737, -53),
    mkflr(-7890937899537737, -53),
    mkflr(8686250625038550, -54),
    mkflr(7032255783343117, -53),
    mkflr(5628233915913940, -53),
    mkflr(-5628233915913940, -53),
    mkflr(7032255783343117, -53),
    mkflr(7942347067146965, -56),
    mkflr(8952318119487099, -53),
    mkflr(-8952318119487099, -53),
    mkflr(7942347067146965, -56),
    mkflr(8855027013722231, -53),
    mkflr(6594706969509681, -55),
    mkflr(-6594706969509681, -55),
    mkflr(8855027013722231, -53),
    mkflr(5095659144473433, -53),
    mkflr(7427240153512674, -53),
    mkflr(-7427240153512674, -53),
    mkflr(5095659144473433, -53),
    mkflr(7550056943179025, -53),
    mkflr(4911850829306697, -53),
    mkflr(-4911850829306697, -53),
    mkflr(7550056943179025, -53),
    mkflr(7461973733147729, -55),
    mkflr(8811899492445997, -53),
    mkflr(-8811899492445997, -53),
    mkflr(7461973733147729, -55),
    mkflr(8363239276060827, -53),
    mkflr(6689055905271015, -54),
    mkflr(-6689055905271015, -54),
    mkflr(8363239276060827, -53),
    mkflr(7097529619223511, -54),
    mkflr(8278641599964811, -53),
    mkflr(-8278641599964811, -53),
    mkflr(7097529619223511, -54),
    mkflr(6446730156091567, -53),
    mkflr(6290414033205309, -53),
    mkflr(-6290414033205309, -53),
    mkflr(6446730156091567, -53),
    mkflr(7074060192106372, -59),
    mkflr(9006521029202651, -53),
    mkflr(-9006521029202651, -53),
    mkflr(7074060192106372, -59),
    mkflr(9007029696760466, -53),
    mkflr(7074193361797233, -60),
    mkflr(-7074193361797233, -60),
    mkflr(9007029696760466, -53),
    mkflr(6329852010540816, -53),
    mkflr(6408011543315061, -53),
    mkflr(-6408011543315061, -53),
    mkflr(6329852010540816, -53),
    mkflr(8300260568395001, -53),
    mkflr(6995802430416048, -54),
    mkflr(-6995802430416048, -54),
    mkflr(8300260568395001, -53),
    mkflr(6791561728666308, -54),
    mkflr(8342560202721672, -53),
    mkflr(-8342560202721672, -53),
    mkflr(6791561728666308, -54),
    mkflr(8823180063448708, -53),
    mkflr(7245558068298598, -55),
    mkflr(-7245558068298598, -55),
    mkflr(8823180063448708, -53),
    mkflr(4958084643600824, -53),
    mkflr(7519776265388244, -53),
    mkflr(-7519776265388244, -53),
    mkflr(4958084643600824, -53),
    mkflr(7458366714537629, -53),
    mkflr(5049990531286555, -53),
    mkflr(-5049990531286555, -53),
    mkflr(7458366714537629, -53),
    mkflr(6811916523300038, -55),
    mkflr(8844744230026167, -53),
    mkflr(-8844744230026167, -53),
    mkflr(6811916523300038, -55),
    mkflr(8958241260309380, -53),
    mkflr(7502754424118275, -56),
    mkflr(-7502754424118275, -56),
    mkflr(8958241260309380, -53),
    mkflr(5671277076310961, -53),
    mkflr(6997589209028812, -53),
    mkflr(-6997589209028812, -53),
    mkflr(5671277076310961, -53),
    mkflr(7917438270796208, -53),
    mkflr(8589251339374868, -54),
    mkflr(-8589251339374868, -54),
    mkflr(7917438270796208, -53),
    mkflr(5123430714424177, -54),
    mkflr(8635233224599694, -53),
    mkflr(-8635233224599694, -53),
    mkflr(5123430714424177, -54),
    mkflr(8603146819336178, -53),
    mkflr(5334980119757703, -54),
    mkflr(-5334980119757703, -54),
    mkflr(8603146819336178, -53),
    mkflr(8394286290816088, -54),
    mkflr(7969543765584135, -53),
    mkflr(-7969543765584135, -53),
    mkflr(8394286290816088, -54),
    mkflr(6927467009660074, -53),
    mkflr(5756721223463751, -53),
    mkflr(-5756721223463751, -53),
    mkflr(6927467009660074, -53),
    mkflr(6622738275719969, -56),
    mkflr(8969075513488470, -53),
    mkflr(-8969075513488470, -53),
    mkflr(6622738275719969, -56),
    mkflr(8993468505216860, -53),
    mkflr(7954473020348387, -57),
    mkflr(-7954473020348387, -57),
    mkflr(8993468505216860, -53),
    mkflr(6007801203085623, -53),
    mkflr(6710883929767346, -53),
    mkflr(-6710883929767346, -53),
    mkflr(6007801203085623, -53),
    mkflr(8118628663374582, -53),
    mkflr(7801924644814081, -54),
    mkflr(-7801924644814081, -54),
    mkflr(8118628663374582, -53),
    mkflr(5964680940960804, -54),
    mkflr(8499134293134885, -53),
    mkflr(-8499134293134885, -53),
    mkflr(5964680940960804, -54),
    mkflr(8723671485748716, -53),
    mkflr(8968562179829241, -55),
    mkflr(-8968562179829241, -55),
    mkflr(8723671485748716, -53),
    mkflr(4583134480704026, -53),
    mkflr(7754000048129257, -53),
    mkflr(-7754000048129257, -53),
    mkflr(4583134480704026, -53),
    mkflr(7201591494446370, -53),
    mkflr(5409872305491543, -53),
    mkflr(-5409872305491543, -53),
    mkflr(7201591494446370, -53),
    mkflr(5067747153968079, -55),
    mkflr(8917651573624763, -53),
    mkflr(-8917651573624763, -53),
    mkflr(5067747153968079, -55),
    mkflr(8901432827556552, -53),
    mkflr(5505098772745492, -55),
    mkflr(-5505098772745492, -55),
    mkflr(8901432827556552, -53),
    mkflr(5321090346314263, -53),
    mkflr(7267436682969301, -53),
    mkflr(-7267436682969301, -53),
    mkflr(5321090346314263, -53),
    mkflr(7697174075937797, -53),
    mkflr(4677942887564769, -53),
    mkflr(-4677942887564769, -53),
    mkflr(7697174075937797, -53),
    mkflr(8539675389073947, -55),
    mkflr(8750529122869341, -53),
    mkflr(-8750529122869341, -53),
    mkflr(8539675389073947, -55),
    mkflr(8461896418689196, -53),
    mkflr(6172826715203219, -54),
    mkflr(-6172826715203219, -54),
    mkflr(8461896418689196, -53),
    mkflr(7602081049296905, -54),
    mkflr(8165888154058130, -53),
    mkflr(-8165888154058130, -53),
    mkflr(7602081049296905, -54),
    mkflr(6636653650073061, -53),
    mkflr(6089701695779408, -53),
    mkflr(-6089701695779408, -53),
    mkflr(6636653650073061, -53),
    mkflr(6188054973828419, -57),
    mkflr(8998892164841951, -53),
    mkflr(-8998892164841951, -53),
    mkflr(6188054973828419, -57),
    mkflr(9002960624407544, -53),
    mkflr(8841410057981697, -58),
    mkflr(-8841410057981697, -58),
    mkflr(9002960624407544, -53),
    mkflr(6170685101797492, -53),
    mkflr(6561423914750605, -53),
    mkflr(-6561423914750605, -53),
    mkflr(6170685101797492, -53),
    mkflr(8211917892022175, -53),
    mkflr(7401092608336357, -54),
    mkflr(-7401092608336357, -54),
    mkflr(8211917892022175, -53),
    mkflr(6380042884447767, -54),
    mkflr(8423384213768154, -53),
    mkflr(-8423384213768154, -53),
    mkflr(6380042884447767, -54),
    mkflr(8776068962491037, -53),
    mkflr(8109502554616454, -55),
    mkflr(-8109502554616454, -55),
    mkflr(8776068962491037, -53),
    mkflr(4772046813433470, -53),
    mkflr(7639188937642932, -53),
    mkflr(-7639188937642932, -53),
    mkflr(4772046813433470, -53),
    mkflr(7332187422259511, -53),
    mkflr(5231507050503336, -53),
    mkflr(-5231507050503336, -53),
    mkflr(7332187422259511, -53),
    mkflr(5941621343897074, -55),
    mkflr(8883873558446555, -53),
    mkflr(-8883873558446555, -53),
    mkflr(5941621343897074, -55),
    mkflr(8932527354167686, -53),
    mkflr(4629632351109917, -55),
    mkflr(-4629632351109917, -55),
    mkflr(8932527354167686, -53),
    mkflr(5497839557798690, -53),
    mkflr(7134661772733911, -53),
    mkflr(-7134661772733911, -53),
    mkflr(5497839557798690, -53),
    mkflr(7809658296434922, -53),
    mkflr(8975271741297168, -54),
    mkflr(-8975271741297168, -54),
    mkflr(7809658296434922, -53),
    mkflr(4698049169054608, -54),
    mkflr(8695500095790524, -53),
    mkflr(-8695500095790524, -53),
    mkflr(4698049169054608, -54),
    mkflr(8535092229218300, -53),
    mkflr(5755636907708500, -54),
    mkflr(-5755636907708500, -54),
    mkflr(8535092229218300, -53),
    mkflr(8000593299177483, -54),
    mkflr(8070146537076992, -53),
    mkflr(-8070146537076992, -53),
    mkflr(8000593299177483, -54),
    mkflr(6784103575026380, -53),
    mkflr(5924995957629083, -53),
    mkflr(-5924995957629083, -53),
    mkflr(6784103575026380, -53),
    mkflr(4859846576245171, -56),
    mkflr(8986690462315460, -53),
    mkflr(-8986690462315460, -53),
    mkflr(4859846576245171, -56),
    mkflr(8978559056886080, -53),
    mkflr(5741724767297686, -56),
    mkflr(-5741724767297686, -56),
    mkflr(8978559056886080, -53),
    mkflr(5841298429575172, -53),
    mkflr(6856301559240908, -53),
    mkflr(-6856301559240908, -53),
    mkflr(5841298429575172, -53),
    mkflr(8020449076395251, -53),
    mkflr(8198057093618523, -54),
    mkflr(-8198057093618523, -54),
    mkflr(8020449076395251, -53),
    mkflr(5545726096708791, -54),
    mkflr(8569764811806532, -53),
    mkflr(-8569764811806532, -53),
    mkflr(5545726096708791, -54),
    mkflr(8666019195502468, -53),
    mkflr(4911109739270519, -54),
    mkflr(-4911109739270519, -54),
    mkflr(8666019195502468, -53),
    mkflr(8782922878275687, -54),
    mkflr(7864140438927325, -53),
    mkflr(-7864140438927325, -53),
    mkflr(8782922878275687, -54),
    mkflr(7066657597201826, -53),
    mkflr(5584978855691076, -53),
    mkflr(-5584978855691076, -53),
    mkflr(7066657597201826, -53),
    mkflr(8381640685297609, -56),
    mkflr(8946057928947489, -53),
    mkflr(-8946057928947489, -53),
    mkflr(8381640685297609, -56),
    mkflr(8864976410656110, -53),
    mkflr(6377249128729266, -55),
    mkflr(-6377249128729266, -55),
    mkflr(8864976410656110, -53),
    mkflr(5141135908973599, -53),
    mkflr(7395833961093832, -53),
    mkflr(-7395833961093832, -53),
    mkflr(5141135908973599, -53),
    mkflr(7580053365593204, -53),
    mkflr(4865432086605035, -53),
    mkflr(-4865432086605035, -53),
    mkflr(7580053365593204, -53),
    mkflr(7678108458903330, -55),
    mkflr(8800287158407901, -53),
    mkflr(-8800287158407901, -53),
    mkflr(7678108458903330, -55),
    mkflr(8383603478168160, -53),
    mkflr(6586298242701558, -54),
    mkflr(-6586298242701558, -54),
    mkflr(8383603478168160, -53),
    mkflr(7198989590052351, -54),
    mkflr(8256710945357489, -53),
    mkflr(-8256710945357489, -53),
    mkflr(7198989590052351, -54),
    mkflr(6485206053121402, -53),
    mkflr(6250739225336809, -53),
    mkflr(-6250739225336809, -53),
    mkflr(6485206053121402, -53),
    mkflr(5305378684473085, -58),
    mkflr(9005673271218593, -53),
    mkflr(-9005673271218593, -53),
    mkflr(5305378684473085, -58),
    mkflr(9005673271218593, -53),
    mkflr(5305378684473085, -58),
    mkflr(-5305378684473085, -58),
    mkflr(9005673271218593, -53),
    mkflr(6250739225336809, -53),
    mkflr(6485206053121402, -53),
    mkflr(-6485206053121402, -53),
    mkflr(6250739225336809, -53),
    mkflr(8256710945357489, -53),
    mkflr(7198989590052351, -54),
    mkflr(-7198989590052351, -54),
    mkflr(8256710945357489, -53),
    mkflr(6586298242701558, -54),
    mkflr(8383603478168160, -53),
    mkflr(-8383603478168160, -53),
    mkflr(6586298242701558, -54),
    mkflr(8800287158407901, -53),
    mkflr(7678108458903330, -55),
    mkflr(-7678108458903330, -55),
    mkflr(8800287158407901, -53),
    mkflr(4865432086605035, -53),
    mkflr(7580053365593204, -53),
    mkflr(-7580053365593204, -53),
    mkflr(4865432086605035, -53),
    mkflr(7395833961093832, -53),
    mkflr(5141135908973599, -53),
    mkflr(-5141135908973599, -53),
    mkflr(7395833961093832, -53),
    mkflr(6377249128729266, -55),
    mkflr(8864976410656110, -53),
    mkflr(-8864976410656110, -53),
    mkflr(6377249128729266, -55),
    mkflr(8946057928947489, -53),
    mkflr(8381640685297609, -56),
    mkflr(-8381640685297609, -56),
    mkflr(8946057928947489, -53),
    mkflr(5584978855691076, -53),
    mkflr(7066657597201826, -53),
    mkflr(-7066657597201826, -53),
    mkflr(5584978855691076, -53),
    mkflr(7864140438927325, -53),
    mkflr(8782922878275687, -54),
    mkflr(-8782922878275687, -54),
    mkflr(7864140438927325, -53),
    mkflr(4911109739270519, -54),
    mkflr(8666019195502468, -53),
    mkflr(-8666019195502468, -53),
    mkflr(4911109739270519, -54),
    mkflr(8569764811806532, -53),
    mkflr(5545726096708791, -54),
    mkflr(-5545726096708791, -54),
    mkflr(8569764811806532, -53),
    mkflr(8198057093618523, -54),
    mkflr(8020449076395251, -53),
    mkflr(-8020449076395251, -53),
    mkflr(8198057093618523, -54),
    mkflr(6856301559240908, -53),
    mkflr(5841298429575172, -53),
    mkflr(-5841298429575172, -53),
    mkflr(6856301559240908, -53),
    mkflr(5741724767297686, -56),
    mkflr(8978559056886080, -53),
    mkflr(-8978559056886080, -53),
    mkflr(5741724767297686, -56),
    mkflr(8986690462315460, -53),
    mkflr(4859846576245171, -56),
    mkflr(-4859846576245171, -56),
    mkflr(8986690462315460, -53),
    mkflr(5924995957629083, -53),
    mkflr(6784103575026380, -53),
    mkflr(-6784103575026380, -53),
    mkflr(5924995957629083, -53),
    mkflr(8070146537076992, -53),
    mkflr(8000593299177483, -54),
    mkflr(-8000593299177483, -54),
    mkflr(8070146537076992, -53),
    mkflr(5755636907708500, -54),
    mkflr(8535092229218300, -53),
    mkflr(-8535092229218300, -53),
    mkflr(5755636907708500, -54),
    mkflr(8695500095790524, -53),
    mkflr(4698049169054608, -54),
    mkflr(-4698049169054608, -54),
    mkflr(8695500095790524, -53),
    mkflr(8975271741297168, -54),
    mkflr(7809658296434922, -53),
    mkflr(-7809658296434922, -53),
    mkflr(8975271741297168, -54),
    mkflr(7134661772733911, -53),
    mkflr(5497839557798690, -53),
    mkflr(-5497839557798690, -53),
    mkflr(7134661772733911, -53),
    mkflr(4629632351109917, -55),
    mkflr(8932527354167686, -53),
    mkflr(-8932527354167686, -53),
    mkflr(4629632351109917, -55),
    mkflr(8883873558446555, -53),
    mkflr(5941621343897074, -55),
    mkflr(-5941621343897074, -55),
    mkflr(8883873558446555, -53),
    mkflr(5231507050503336, -53),
    mkflr(7332187422259511, -53),
    mkflr(-7332187422259511, -53),
    mkflr(5231507050503336, -53),
    mkflr(7639188937642932, -53),
    mkflr(4772046813433470, -53),
    mkflr(-4772046813433470, -53),
    mkflr(7639188937642932, -53),
    mkflr(8109502554616454, -55),
    mkflr(8776068962491037, -53),
    mkflr(-8776068962491037, -53),
    mkflr(8109502554616454, -55),
    mkflr(8423384213768154, -53),
    mkflr(6380042884447767, -54),
    mkflr(-6380042884447767, -54),
    mkflr(8423384213768154, -53),
    mkflr(7401092608336357, -54),
    mkflr(8211917892022175, -53),
    mkflr(-8211917892022175, -53),
    mkflr(7401092608336357, -54),
    mkflr(6561423914750605, -53),
    mkflr(6170685101797492, -53),
    mkflr(-6170685101797492, -53),
    mkflr(6561423914750605, -53),
    mkflr(8841410057981697, -58),
    mkflr(9002960624407544, -53),
    mkflr(-9002960624407544, -53),
    mkflr(8841410057981697, -58),
    mkflr(8998892164841951, -53),
    mkflr(6188054973828419, -57),
    mkflr(-6188054973828419, -57),
    mkflr(8998892164841951, -53),
    mkflr(6089701695779408, -53),
    mkflr(6636653650073061, -53),
    mkflr(-6636653650073061, -53),
    mkflr(6089701695779408, -53),
    mkflr(8165888154058130, -53),
    mkflr(7602081049296905, -54),
    mkflr(-7602081049296905, -54),
    mkflr(8165888154058130, -53),
    mkflr(6172826715203219, -54),
    mkflr(8461896418689196, -53),
    mkflr(-8461896418689196, -53),
    mkflr(6172826715203219, -54),
    mkflr(8750529122869341, -53),
    mkflr(8539675389073947, -55),
    mkflr(-8539675389073947, -55),
    mkflr(8750529122869341, -53),
    mkflr(4677942887564769, -53),
    mkflr(7697174075937797, -53),
    mkflr(-7697174075937797, -53),
    mkflr(4677942887564769, -53),
    mkflr(7267436682969301, -53),
    mkflr(5321090346314263, -53),
    mkflr(-5321090346314263, -53),
    mkflr(7267436682969301, -53),
    mkflr(5505098772745492, -55),
    mkflr(8901432827556552, -53),
    mkflr(-8901432827556552, -53),
    mkflr(5505098772745492, -55),
    mkflr(8917651573624763, -53),
    mkflr(5067747153968079, -55),
    mkflr(-5067747153968079, -55),
    mkflr(8917651573624763, -53),
    mkflr(5409872305491543, -53),
    mkflr(7201591494446370, -53),
    mkflr(-7201591494446370, -53),
    mkflr(5409872305491543, -53),
    mkflr(7754000048129257, -53),
    mkflr(4583134480704026, -53),
    mkflr(-4583134480704026, -53),
    mkflr(7754000048129257, -53),
    mkflr(8968562179829241, -55),
    mkflr(8723671485748716, -53),
    mkflr(-8723671485748716, -53),
    mkflr(8968562179829241, -55),
    mkflr(8499134293134885, -53),
    mkflr(5964680940960804, -54),
    mkflr(-5964680940960804, -54),
    mkflr(8499134293134885, -53),
    mkflr(7801924644814081, -54),
    mkflr(8118628663374582, -53),
    mkflr(-8118628663374582, -53),
    mkflr(7801924644814081, -54),
    mkflr(6710883929767346, -53),
    mkflr(6007801203085623, -53),
    mkflr(-6007801203085623, -53),
    mkflr(6710883929767346, -53),
    mkflr(7954473020348387, -57),
    mkflr(8993468505216860, -53),
    mkflr(-8993468505216860, -53),
    mkflr(7954473020348387, -57),
    mkflr(8969075513488470, -53),
    mkflr(6622738275719969, -56),
    mkflr(-6622738275719969, -56),
    mkflr(8969075513488470, -53),
    mkflr(5756721223463751, -53),
    mkflr(6927467009660074, -53),
    mkflr(-6927467009660074, -53),
    mkflr(5756721223463751, -53),
    mkflr(7969543765584135, -53),
    mkflr(8394286290816088, -54),
    mkflr(-8394286290816088, -54),
    mkflr(7969543765584135, -53),
    mkflr(5334980119757703, -54),
    mkflr(8603146819336178, -53),
    mkflr(-8603146819336178, -53),
    mkflr(5334980119757703, -54),
    mkflr(8635233224599694, -53),
    mkflr(5123430714424177, -54),
    mkflr(-5123430714424177, -54),
    mkflr(8635233224599694, -53),
    mkflr(8589251339374868, -54),
    mkflr(7917438270796208, -53),
    mkflr(-7917438270796208, -53),
    mkflr(8589251339374868, -54),
    mkflr(6997589209028812, -53),
    mkflr(5671277076310961, -53),
    mkflr(-5671277076310961, -53),
    mkflr(6997589209028812, -53),
    mkflr(7502754424118275, -56),
    mkflr(8958241260309380, -53),
    mkflr(-8958241260309380, -53),
    mkflr(7502754424118275, -56),
    mkflr(8844744230026167, -53),
    mkflr(6811916523300038, -55),
    mkflr(-6811916523300038, -55),
    mkflr(8844744230026167, -53),
    mkflr(5049990531286555, -53),
    mkflr(7458366714537629, -53),
    mkflr(-7458366714537629, -53),
    mkflr(5049990531286555, -53),
    mkflr(7519776265388244, -53),
    mkflr(4958084643600824, -53),
    mkflr(-4958084643600824, -53),
    mkflr(7519776265388244, -53),
    mkflr(7245558068298598, -55),
    mkflr(8823180063448708, -53),
    mkflr(-8823180063448708, -53),
    mkflr(7245558068298598, -55),
    mkflr(8342560202721672, -53),
    mkflr(6791561728666308, -54),
    mkflr(-6791561728666308, -54),
    mkflr(8342560202721672, -53),
    mkflr(6995802430416048, -54),
    mkflr(8300260568395001, -53),
    mkflr(-8300260568395001, -53),
    mkflr(6995802430416048, -54),
    mkflr(6408011543315061, -53),
    mkflr(6329852010540816, -53),
    mkflr(-6329852010540816, -53),
    mkflr(6408011543315061, -53),
    mkflr(7074193361797233, -60),
    mkflr(9007029696760466, -53),
    mkflr(-9007029696760466, -53),
    mkflr(7074193361797233, -60),
    mkflr(9007156865146114, -53),
    mkflr(7074226654454970, -61),
    mkflr(-7074226654454970, -61),
    mkflr(9007156865146114, -53),
    mkflr(6349481723403377, -53),
    mkflr(6388561673708188, -53),
    mkflr(-6388561673708188, -53),
    mkflr(6349481723403377, -53),
    mkflr(8310952915477583, -53),
    mkflr(6944839825747268, -54),
    mkflr(-6944839825747268, -54),
    mkflr(8310952915477583, -53),
    mkflr(6842718994272319, -54),
    mkflr(8332102832176454, -53),
    mkflr(-8332102832176454, -53),
    mkflr(6842718994272319, -54),
    mkflr(8828695804602461, -53),
    mkflr(7137247429536506, -55),
    mkflr(-7137247429536506, -55),
    mkflr(8828695804602461, -53),
    mkflr(4981131658359743, -53),
    mkflr(7504529686575502, -53),
    mkflr(-7504529686575502, -53),
    mkflr(4981131658359743, -53),
    mkflr(7473824766646994, -53),
    mkflr(5027084818466930, -53),
    mkflr(-5027084818466930, -53),
    mkflr(7473824766646994, -53),
    mkflr(6920425636632580, -55),
    mkflr(8839477938633966, -53),
    mkflr(-8839477938633966, -53),
    mkflr(6920425636632580, -55),
    mkflr(8961076366892190, -53),
    mkflr(7282851139856476, -56),
    mkflr(-7282851139856476, -56),
    mkflr(8961076366892190, -53),
    mkflr(5692718687339392, -53),
    mkflr(6980157044180565, -53),
    mkflr(-6980157044180565, -53),
    mkflr(5692718687339392, -53),
    mkflr(7930576735691761, -53),
    mkflr(8540630200145957, -54),
    mkflr(-8540630200145957, -54),
    mkflr(7930576735691761, -53),
    mkflr(5176391646926010, -54),
    mkflr(8627333353592832, -53),
    mkflr(-8627333353592832, -53),
    mkflr(5176391646926010, -54),
    mkflr(8611290075458352, -53),
    mkflr(5282166847391008, -54),
    mkflr(-5282166847391008, -54),
    mkflr(8611290075458352, -53),
    mkflr(8443147217093086, -54),
    mkflr(7956629605695492, -53),
    mkflr(-7956629605695492, -53),
    mkflr(8443147217093086, -54),
    mkflr(6945095779491208, -53),
    mkflr(5735440961974946, -53),
    mkflr(-5735440961974946, -53),
    mkflr(6945095779491208, -53),
    mkflr(6842840994885793, -56),
    mkflr(8966493518975884, -53),
    mkflr(-8966493518975884, -53),
    mkflr(6842840994885793, -56),
    mkflr(8994951428947667, -53),
    mkflr(7512970424714007, -57),
    mkflr(-7512970424714007, -57),
    mkflr(8994951428947667, -53),
    mkflr(6028361630966943, -53),
    mkflr(6692420672738099, -53),
    mkflr(-6692420672738099, -53),
    mkflr(6028361630966943, -53),
    mkflr(8130558439301216, -53),
    mkflr(7752072724043411, -54),
    mkflr(-7752072724043411, -54),
    mkflr(8130558439301216, -53),
    mkflr(6016802823104436, -54),
    mkflr(8489944602974586, -53),
    mkflr(-8489944602974586, -53),
    mkflr(6016802823104436, -54),
    mkflr(8730509220737932, -53),
    mkflr(8861464584337410, -55),
    mkflr(-8861464584337410, -55),
    mkflr(8730509220737932, -53),
    mkflr(4606901848488119, -53),
    mkflr(7739902697902825, -53),
    mkflr(-7739902697902825, -53),
    mkflr(4606901848488119, -53),
    mkflr(7218154856711858, -53),
    mkflr(5387752674272799, -53),
    mkflr(-5387752674272799, -53),
    mkflr(7218154856711858, -53),
    mkflr(5177159182005257, -55),
    mkflr(8913722698169820, -53),
    mkflr(-8913722698169820, -53),
    mkflr(5177159182005257, -55),
    mkflr(8905613286971281, -53),
    mkflr(5395836020528807, -55),
    mkflr(-5395836020528807, -55),
    mkflr(8905613286971281, -53),
    mkflr(5343361485770773, -53),
    mkflr(7251077605914050, -53),
    mkflr(-7251077605914050, -53),
    mkflr(5343361485770773, -53),
    mkflr(7711489578089543, -53),
    mkflr(4654306275012748, -53),
    mkflr(-4654306275012748, -53),
    mkflr(7711489578089543, -53),
    mkflr(8647020179743560, -55),
    mkflr(8743938102497119, -53),
    mkflr(-8743938102497119, -53),
    mkflr(8647020179743560, -55),
    mkflr(8471325578127065, -53),
    mkflr(6120876200014774, -54),
    mkflr(-6120876200014774, -54),
    mkflr(8471325578127065, -53),
    mkflr(7652150456031602, -54),
    mkflr(8154188295849595, -53),
    mkflr(-8154188295849595, -53),
    mkflr(7652150456031602, -54),
    mkflr(6655305358219218, -53),
    mkflr(6069312070034399, -53),
    mkflr(-6069312070034399, -53),
    mkflr(6655305358219218, -53),
    mkflr(6629757244884614, -57),
    mkflr(8997663271522660, -53),
    mkflr(-8997663271522660, -53),
    mkflr(6629757244884614, -57),
    mkflr(9003765913003641, -53),
    mkflr(7957506242722589, -58),
    mkflr(-7957506242722589, -58),
    mkflr(9003765913003641, -53),
    mkflr(6190786226252304, -53),
    mkflr(6542461640350018, -53),
    mkflr(-6542461640350018, -53),
    mkflr(6190786226252304, -53),
    mkflr(8223232361233372, -53),
    mkflr(7350670159317696, -54),
    mkflr(-7350670159317696, -54),
    mkflr(8223232361233372, -53),
    mkflr(6431698015882422, -54),
    mkflr(8413557723860353, -53),
    mkflr(-8413557723860353, -53),
    mkflr(6431698015882422, -54),
    mkflr(8782247561441008, -53),
    mkflr(8001765989250269, -55),
    mkflr(-8001765989250269, -55),
    mkflr(8782247561441008, -53),
    mkflr(4795461056637271, -53),
    mkflr(7624512552870645, -53),
    mkflr(-7624512552870645, -53),
    mkflr(4795461056637271, -53),
    mkflr(7348202953025374, -53),
    mkflr(5208987596045498, -53),
    mkflr(-5208987596045498, -53),
    mkflr(7348202953025374, -53),
    mkflr(6050614741355486, -55),
    mkflr(8879274589899640, -53),
    mkflr(-8879274589899640, -53),
    mkflr(6050614741355486, -55),
    mkflr(8936036193963400, -53),
    mkflr(4519992132352091, -55),
    mkflr(-4519992132352091, -55),
    mkflr(8936036193963400, -53),
    mkflr(5519702517755945, -53),
    mkflr(7117761061603948, -53),
    mkflr(-7117761061603948, -53),
    mkflr(5519702517755945, -53),
    mkflr(7823389415514919, -53),
    mkflr(8927310113985246, -54),
    mkflr(-8927310113985246, -54),
    mkflr(7823389415514919, -53),
    mkflr(4751381895793102, -54),
    mkflr(8688252467250769, -53),
    mkflr(-8688252467250769, -53),
    mkflr(4751381895793102, -54),
    mkflr(8543881084037075, -53),
    mkflr(5703239232730864, -54),
    mkflr(-5703239232730864, -54),
    mkflr(8543881084037075, -53),
    mkflr(8050073368155017, -54),
    mkflr(8057835820270665, -53),
    mkflr(-8057835820270665, -53),
    mkflr(8050073368155017, -54),
    mkflr(6802249279161855, -53),
    mkflr(5904154737026182, -53),
    mkflr(-5904154737026182, -53),
    mkflr(6802249279161855, -53),
    mkflr(5080389927126093, -56),
    mkflr(8984784444342543, -53),
    mkflr(-8984784444342543, -53),
    mkflr(5080389927126093, -56),
    mkflr(8980718722493792, -53),
    mkflr(5521331097805465, -56),
    mkflr(-5521331097805465, -56),
    mkflr(8980718722493792, -53),
    mkflr(5862305776050047, -53),
    mkflr(6838348441158650, -53),
    mkflr(-6838348441158650, -53),
    mkflr(5862305776050047, -53),
    mkflr(8032986972986387, -53),
    mkflr(8148805730028833, -54),
    mkflr(-8148805730028833, -54),
    mkflr(8032986972986387, -53),
    mkflr(5598283333288561, -54),
    mkflr(8561217456919463, -53),
    mkflr(-8561217456919463, -53),
    mkflr(5598283333288561, -54),
    mkflr(8673511947735049, -53),
    mkflr(4857912682255224, -54),
    mkflr(-4857912682255224, -54),
    mkflr(8673511947735049, -53),
    mkflr(8831135229857187, -54),
    mkflr(7850630614963393, -53),
    mkflr(-7850630614963393, -53),
    mkflr(8831135229857187, -54),
    mkflr(7083758813816853, -53),
    mkflr(5563272371750168, -53),
    mkflr(-5563272371750168, -53),
    mkflr(7083758813816853, -53),
    mkflr(8601170191100479, -56),
    mkflr(8942801513192182, -53),
    mkflr(-8942801513192182, -53),
    mkflr(8601170191100479, -56),
    mkflr(8869825971537420, -53),
    mkflr(6268429658850061, -55),
    mkflr(-6268429658850061, -55),
    mkflr(8869825971537420, -53),
    mkflr(5163801812627728, -53),
    mkflr(7380026372209606, -53),
    mkflr(-7380026372209606, -53),
    mkflr(5163801812627728, -53),
    mkflr(7594944627693494, -53),
    mkflr(4842153912968527, -53),
    mkflr(-4842153912968527, -53),
    mkflr(7594944627693494, -53),
    mkflr(7786067926277549, -55),
    mkflr(8794356716387429, -53),
    mkflr(-8794356716387429, -53),
    mkflr(7786067926277549, -55),
    mkflr(8393667262452058, -53),
    mkflr(6534826180350098, -54),
    mkflr(-6534826180350098, -54),
    mkflr(8393667262452058, -53),
    mkflr(7249618174605810, -54),
    mkflr(8245628993303844, -53),
    mkflr(-8245628993303844, -53),
    mkflr(7249618174605810, -54),
    mkflr(6504352530186687, -53),
    mkflr(6230813476397823, -53),
    mkflr(-6230813476397823, -53),
    mkflr(6504352530186687, -53),
    mkflr(6189482235310630, -58),
    mkflr(9005122242792311, -53),
    mkflr(-9005122242792311, -53),
    mkflr(6189482235310630, -58),
    mkflr(9006139534818257, -53),
    mkflr(8842450394781643, -59),
    mkflr(-8842450394781643, -59),
    mkflr(9006139534818257, -53),
    mkflr(6270606139937627, -53),
    mkflr(6465998534826869, -53),
    mkflr(-6465998534826869, -53),
    mkflr(6270606139937627, -53),
    mkflr(8267715182103167, -53),
    mkflr(7148293245867151, -54),
    mkflr(-7148293245867151, -54),
    mkflr(8267715182103167, -53),
    mkflr(6637708312305582, -54),
    mkflr(8373460784215450, -53),
    mkflr(-8373460784215450, -53),
    mkflr(6637708312305582, -54),
    mkflr(8806134768774068, -53),
    mkflr(7570076722248107, -55),
    mkflr(-7570076722248107, -55),
    mkflr(8806134768774068, -53),
    mkflr(4888664464941756, -53),
    mkflr(7565090757143791, -53),
    mkflr(-7565090757143791, -53),
    mkflr(4888664464941756, -53),
    mkflr(7411571937572131, -53),
    mkflr(5118421614990306, -53),
    mkflr(-5118421614990306, -53),
    mkflr(7411571937572131, -53),
    mkflr(6486008573510911, -55),
    mkflr(8860043409240618, -53),
    mkflr(-8860043409240618, -53),
    mkflr(6486008573510911, -55),
    mkflr(8949230140998484, -53),
    mkflr(8162032288300481, -56),
    mkflr(-8162032288300481, -56),
    mkflr(8949230140998484, -53),
    mkflr(5606632771683968, -53),
    mkflr(7049489866514174, -53),
    mkflr(-7049489866514174, -53),
    mkflr(5606632771683968, -53),
    mkflr(7877576242606407, -53),
    mkflr(8734627858479102, -54),
    mkflr(-8734627858479102, -54),
    mkflr(7877576242606407, -53),
    mkflr(4964260571050563, -54),
    mkflr(8658444875396786, -53),
    mkflr(-8658444875396786, -53),
    mkflr(4964260571050563, -54),
    mkflr(8578231504803418, -53),
    mkflr(5493116661642923, -54),
    mkflr(-5493116661642923, -54),
    mkflr(8578231504803418, -53),
    mkflr(8247231293972637, -54),
    mkflr(8007835688282839, -53),
    mkflr(-8007835688282839, -53),
    mkflr(8247231293972637, -54),
    mkflr(6874190143201685, -53),
    mkflr(5820236102574833, -53),
    mkflr(-5820236102574833, -53),
    mkflr(6874190143201685, -53),
    mkflr(5962064393489674, -56),
    mkflr(8976314881661062, -53),
    mkflr(-8976314881661062, -53),
    mkflr(5962064393489674, -56),
    mkflr(8988511894135185, -53),
    mkflr(4639257482637412, -56),
    mkflr(-4639257482637412, -56),
    mkflr(8988511894135185, -53),
    mkflr(5945781409913510, -53),
    mkflr(6765894016324346, -53),
    mkflr(-6765894016324346, -53),
    mkflr(5945781409913510, -53),
    mkflr(8082381294590617, -53),
    mkflr(7951037925568809, -54),
    mkflr(-7951037925568809, -54),
    mkflr(8082381294590617, -53),
    mkflr(5807980408439539, -54),
    mkflr(8526223038860894, -53),
    mkflr(-8526223038860894, -53),
    mkflr(5807980408439539, -54),
    mkflr(8702665878971716, -53),
    mkflr(4644672222488094, -54),
    mkflr(-4644672222488094, -54),
    mkflr(8702665878971716, -53),
    mkflr(4511574444966625, -53),
    mkflr(7795853669876749, -53),
    mkflr(-7795853669876749, -53),
    mkflr(4511574444966625, -53),
    mkflr(7151495329710049, -53),
    mkflr(5475924850081677, -53),
    mkflr(-5475924850081677, -53),
    mkflr(7151495329710049, -53),
    mkflr(4739228994004870, -55),
    mkflr(8928934438022583, -53),
    mkflr(-8928934438022583, -53),
    mkflr(4739228994004870, -55),
    mkflr(8888388908592136, -53),
    mkflr(5832572021635720, -55),
    mkflr(-5832572021635720, -55),
    mkflr(8888388908592136, -53),
    mkflr(5253977264024408, -53),
    mkflr(7316102878153182, -53),
    mkflr(-7316102878153182, -53),
    mkflr(5253977264024408, -53),
    mkflr(7653793419459571, -53),
    mkflr(4748587653907638, -53),
    mkflr(-4748587653907638, -53),
    mkflr(7653793419459571, -53),
    mkflr(8217162790256110, -55),
    mkflr(8769807759837646, -53),
    mkflr(-8769807759837646, -53),
    mkflr(8217162790256110, -55),
    mkflr(8433131419575708, -53),
    mkflr(6328327701619659, -54),
    mkflr(-6328327701619659, -54),
    mkflr(8433131419575708, -53),
    mkflr(7451445395452699, -54),
    mkflr(8200526129112289, -53),
    mkflr(-8200526129112289, -53),
    mkflr(7451445395452699, -54),
    mkflr(6580324430530404, -53),
    mkflr(6150525896504412, -53),
    mkflr(-6150525896504412, -53),
    mkflr(6580324430530404, -53),
    mkflr(4862615327261055, -57),
    mkflr(9002070596517294, -53),
    mkflr(-9002070596517294, -53),
    mkflr(4862615327261055, -57),
    mkflr(9000036357160980, -53),
    mkflr(5746294458442105, -57),
    mkflr(-5746294458442105, -57),
    mkflr(9000036357160980, -53),
    mkflr(6110034002932808, -53),
    mkflr(6617939475215195, -53),
    mkflr(-6617939475215195, -53),
    mkflr(6110034002932808, -53),
    mkflr(8177511151817401, -53),
    mkflr(7551940088880137, -54),
    mkflr(-7551940088880137, -54),
    mkflr(8177511151817401, -53),
    mkflr(6224719129395714, -54),
    mkflr(8452387612659540, -53),
    mkflr(-8452387612659540, -53),
    mkflr(6224719129395714, -54),
    mkflr(8757037779928840, -53),
    mkflr(8432250219727258, -55),
    mkflr(-8432250219727258, -55),
    mkflr(8757037779928840, -53),
    mkflr(4701535469536748, -53),
    mkflr(7682786125052197, -53),
    mkflr(-7682786125052197, -53),
    mkflr(4701535469536748, -53),
    mkflr(7283727356142706, -53),
    mkflr(5298769122728888, -53),
    mkflr(-5298769122728888, -53),
    mkflr(7283727356142706, -53),
    mkflr(5614309708875923, -55),
    mkflr(8897168584465961, -53),
    mkflr(-8897168584465961, -53),
    mkflr(5614309708875923, -55),
    mkflr(8921496512746829, -53),
    mkflr(4958287426364647, -55),
    mkflr(-4958287426364647, -55),
    mkflr(8921496512746829, -53),
    mkflr(5431941016931809, -53),
    mkflr(7184960348059028, -53),
    mkflr(-7184960348059028, -53),
    mkflr(5431941016931809, -53),
    mkflr(7768024414754142, -53),
    mkflr(4559323974712726, -53),
    mkflr(-4559323974712726, -53),
    mkflr(7768024414754142, -53),
    mkflr(4537787679899090, -54),
    mkflr(8716751640241088, -53),
    mkflr(-8716751640241088, -53),
    mkflr(4537787679899090, -54),
    mkflr(8508243986206341, -53),
    mkflr(5912502916968520, -54),
    mkflr(-5912502916968520, -54),
    mkflr(8508243986206341, -53),
    mkflr(7851703130898649, -54),
    mkflr(8106622471823008, -53),
    mkflr(-8106622471823008, -53),
    mkflr(7851703130898649, -54),
    mkflr(6729284021401222, -53),
    mkflr(5987184227491324, -53),
    mkflr(-5987184227491324, -53),
    mkflr(6729284021401222, -53),
    mkflr(8395900745453257, -57),
    mkflr(8991900931535341, -53),
    mkflr(-8991900931535341, -53),
    mkflr(8395900745453257, -57),
    mkflr(8971573087646471, -53),
    mkflr(6402573220819241, -56),
    mkflr(-6402573220819241, -56),
    mkflr(8971573087646471, -53),
    mkflr(5777947300499967, -53),
    mkflr(6909773035871137, -53),
    mkflr(-6909773035871137, -53),
    mkflr(5777947300499967, -53),
    mkflr(7982382913091674, -53),
    mkflr(8345346354319577, -54),
    mkflr(-8345346354319577, -54),
    mkflr(7982382913091674, -53),
    mkflr(5387743177259695, -54),
    mkflr(8594922587119653, -53),
    mkflr(-8594922587119653, -53),
    mkflr(5387743177259695, -54),
    mkflr(8643051817502737, -53),
    mkflr(5070421558241214, -54),
    mkflr(-5070421558241214, -54),
    mkflr(8643051817502737, -53),
    mkflr(8637791633298976, -54),
    mkflr(7904225283956311, -53),
    mkflr(-7904225283956311, -53),
    mkflr(8637791633298976, -54),
    mkflr(7014955509902409, -53),
    mkflr(5649782085062796, -53),
    mkflr(-5649782085062796, -53),
    mkflr(7014955509902409, -53),
    mkflr(7722587089598028, -56),
    mkflr(8955321835348103, -53),
    mkflr(-8955321835348103, -53),
    mkflr(7722587089598028, -56),
    mkflr(8849927271317175, -53),
    mkflr(6703343293614876, -55),
    mkflr(-6703343293614876, -55),
    mkflr(8849927271317175, -53),
    mkflr(5072848711672022, -53),
    mkflr(7442838461440245, -53),
    mkflr(-7442838461440245, -53),
    mkflr(5072848711672022, -53),
    mkflr(7534952065202888, -53),
    mkflr(4934990961460965, -53),
    mkflr(-4934990961460965, -53),
    mkflr(7534952065202888, -53),
    mkflr(7353800509108698, -55),
    mkflr(8817581275163911, -53),
    mkflr(-8817581275163911, -53),
    mkflr(7353800509108698, -55),
    mkflr(8352939049913017, -53),
    mkflr(6740340538294756, -54),
    mkflr(-6740340538294756, -54),
    mkflr(8352939049913017, -53),
    mkflr(7046699187928017, -54),
    mkflr(8289490096098815, -53),
    mkflr(-8289490096098815, -53),
    mkflr(7046699187928017, -54),
    mkflr(6427401098276813, -53),
    mkflr(6310162718700422, -53),
    mkflr(-6310162718700422, -53),
    mkflr(6427401098276813, -53),
    mkflr(5305603405682435, -59),
    mkflr(9006817750781007, -53),
    mkflr(-9006817750781007, -53),
    mkflr(5305603405682435, -59),
    mkflr(9006817750781007, -53),
    mkflr(5305603405682435, -59),
    mkflr(-5305603405682435, -59),
    mkflr(9006817750781007, -53),
    mkflr(6310162718700422, -53),
    mkflr(6427401098276813, -53),
    mkflr(-6427401098276813, -53),
    mkflr(6310162718700422, -53),
    mkflr(8289490096098815, -53),
    mkflr(7046699187928017, -54),
    mkflr(-7046699187928017, -54),
    mkflr(8289490096098815, -53),
    mkflr(6740340538294756, -54),
    mkflr(8352939049913017, -53),
    mkflr(-8352939049913017, -53),
    mkflr(6740340538294756, -54),
    mkflr(8817581275163911, -53),
    mkflr(7353800509108698, -55),
    mkflr(-7353800509108698, -55),
    mkflr(8817581275163911, -53),
    mkflr(4934990961460965, -53),
    mkflr(7534952065202888, -53),
    mkflr(-7534952065202888, -53),
    mkflr(4934990961460965, -53),
    mkflr(7442838461440245, -53),
    mkflr(5072848711672022, -53),
    mkflr(-5072848711672022, -53),
    mkflr(7442838461440245, -53),
    mkflr(6703343293614876, -55),
    mkflr(8849927271317175, -53),
    mkflr(-8849927271317175, -53),
    mkflr(6703343293614876, -55),
    mkflr(8955321835348103, -53),
    mkflr(7722587089598028, -56),
    mkflr(-7722587089598028, -56),
    mkflr(8955321835348103, -53),
    mkflr(5649782085062796, -53),
    mkflr(7014955509902409, -53),
    mkflr(-7014955509902409, -53),
    mkflr(5649782085062796, -53),
    mkflr(7904225283956311, -53),
    mkflr(8637791633298976, -54),
    mkflr(-8637791633298976, -54),
    mkflr(7904225283956311, -53),
    mkflr(5070421558241214, -54),
    mkflr(8643051817502737, -53),
    mkflr(-8643051817502737, -53),
    mkflr(5070421558241214, -54),
    mkflr(8594922587119653, -53),
    mkflr(5387743177259695, -54),
    mkflr(-5387743177259695, -54),
    mkflr(8594922587119653, -53),
    mkflr(8345346354319577, -54),
    mkflr(7982382913091674, -53),
    mkflr(-7982382913091674, -53),
    mkflr(8345346354319577, -54),
    mkflr(6909773035871137, -53),
    mkflr(5777947300499967, -53),
    mkflr(-5777947300499967, -53),
    mkflr(6909773035871137, -53),
    mkflr(6402573220819241, -56),
    mkflr(8971573087646471, -53),
    mkflr(-8971573087646471, -53),
    mkflr(6402573220819241, -56),
    mkflr(8991900931535341, -53),
    mkflr(8395900745453257, -57),
    mkflr(-8395900745453257, -57),
    mkflr(8991900931535341, -53),
    mkflr(5987184227491324, -53),
    mkflr(6729284021401222, -53),
    mkflr(-6729284021401222, -53),
    mkflr(5987184227491324, -53),
    mkflr(8106622471823008, -53),
    mkflr(7851703130898649, -54),
    mkflr(-7851703130898649, -54),
    mkflr(8106622471823008, -53),
    mkflr(5912502916968520, -54),
    mkflr(8508243986206341, -53),
    mkflr(-8508243986206341, -53),
    mkflr(5912502916968520, -54),
    mkflr(8716751640241088, -53),
    mkflr(4537787679899090, -54),
    mkflr(-4537787679899090, -54),
    mkflr(8716751640241088, -53),
    mkflr(4559323974712726, -53),
    mkflr(7768024414754142, -53),
    mkflr(-7768024414754142, -53),
    mkflr(4559323974712726, -53),
    mkflr(7184960348059028, -53),
    mkflr(5431941016931809, -53),
    mkflr(-5431941016931809, -53),
    mkflr(7184960348059028, -53),
    mkflr(4958287426364647, -55),
    mkflr(8921496512746829, -53),
    mkflr(-8921496512746829, -53),
    mkflr(4958287426364647, -55),
    mkflr(8897168584465961, -53),
    mkflr(5614309708875923, -55),
    mkflr(-5614309708875923, -55),
    mkflr(8897168584465961, -53),
    mkflr(5298769122728888, -53),
    mkflr(7283727356142706, -53),
    mkflr(-7283727356142706, -53),
    mkflr(5298769122728888, -53),
    mkflr(7682786125052197, -53),
    mkflr(4701535469536748, -53),
    mkflr(-4701535469536748, -53),
    mkflr(7682786125052197, -53),
    mkflr(8432250219727258, -55),
    mkflr(8757037779928840, -53),
    mkflr(-8757037779928840, -53),
    mkflr(8432250219727258, -55),
    mkflr(8452387612659540, -53),
    mkflr(6224719129395714, -54),
    mkflr(-6224719129395714, -54),
    mkflr(8452387612659540, -53),
    mkflr(7551940088880137, -54),
    mkflr(8177511151817401, -53),
    mkflr(-8177511151817401, -53),
    mkflr(7551940088880137, -54),
    mkflr(6617939475215195, -53),
    mkflr(6110034002932808, -53),
    mkflr(-6110034002932808, -53),
    mkflr(6617939475215195, -53),
    mkflr(5746294458442105, -57),
    mkflr(9000036357160980, -53),
    mkflr(-9000036357160980, -53),
    mkflr(5746294458442105, -57),
    mkflr(9002070596517294, -53),
    mkflr(4862615327261055, -57),
    mkflr(-4862615327261055, -57),
    mkflr(9002070596517294, -53),
    mkflr(6150525896504412, -53),
    mkflr(6580324430530404, -53),
    mkflr(-6580324430530404, -53),
    mkflr(6150525896504412, -53),
    mkflr(8200526129112289, -53),
    mkflr(7451445395452699, -54),
    mkflr(-7451445395452699, -54),
    mkflr(8200526129112289, -53),
    mkflr(6328327701619659, -54),
    mkflr(8433131419575708, -53),
    mkflr(-8433131419575708, -53),
    mkflr(6328327701619659, -54),
    mkflr(8769807759837646, -53),
    mkflr(8217162790256110, -55),
    mkflr(-8217162790256110, -55),
    mkflr(8769807759837646, -53),
    mkflr(4748587653907638, -53),
    mkflr(7653793419459571, -53),
    mkflr(-7653793419459571, -53),
    mkflr(4748587653907638, -53),
    mkflr(7316102878153182, -53),
    mkflr(5253977264024408, -53),
    mkflr(-5253977264024408, -53),
    mkflr(7316102878153182, -53),
    mkflr(5832572021635720, -55),
    mkflr(8888388908592136, -53),
    mkflr(-8888388908592136, -53),
    mkflr(5832572021635720, -55),
    mkflr(8928934438022583, -53),
    mkflr(4739228994004870, -55),
    mkflr(-4739228994004870, -55),
    mkflr(8928934438022583, -53),
    mkflr(5475924850081677, -53),
    mkflr(7151495329710049, -53),
    mkflr(-7151495329710049, -53),
    mkflr(5475924850081677, -53),
    mkflr(7795853669876749, -53),
    mkflr(4511574444966625, -53),
    mkflr(-4511574444966625, -53),
    mkflr(7795853669876749, -53),
    mkflr(4644672222488094, -54),
    mkflr(8702665878971716, -53),
    mkflr(-8702665878971716, -53),
    mkflr(4644672222488094, -54),
    mkflr(8526223038860894, -53),
    mkflr(5807980408439539, -54),
    mkflr(-5807980408439539, -54),
    mkflr(8526223038860894, -53),
    mkflr(7951037925568809, -54),
    mkflr(8082381294590617, -53),
    mkflr(-8082381294590617, -53),
    mkflr(7951037925568809, -54),
    mkflr(6765894016324346, -53),
    mkflr(5945781409913510, -53),
    mkflr(-5945781409913510, -53),
    mkflr(6765894016324346, -53),
    mkflr(4639257482637412, -56),
    mkflr(8988511894135185, -53),
    mkflr(-8988511894135185, -53),
    mkflr(4639257482637412, -56),
    mkflr(8976314881661062, -53),
    mkflr(5962064393489674, -56),
    mkflr(-5962064393489674, -56),
    mkflr(8976314881661062, -53),
    mkflr(5820236102574833, -53),
    mkflr(6874190143201685, -53),
    mkflr(-6874190143201685, -53),
    mkflr(5820236102574833, -53),
    mkflr(8007835688282839, -53),
    mkflr(8247231293972637, -54),
    mkflr(-8247231293972637, -54),
    mkflr(8007835688282839, -53),
    mkflr(5493116661642923, -54),
    mkflr(8578231504803418, -53),
    mkflr(-8578231504803418, -53),
    mkflr(5493116661642923, -54),
    mkflr(8658444875396786, -53),
    mkflr(4964260571050563, -54),
    mkflr(-4964260571050563, -54),
    mkflr(8658444875396786, -53),
    mkflr(8734627858479102, -54),
    mkflr(7877576242606407, -53),
    mkflr(-7877576242606407, -53),
    mkflr(8734627858479102, -54),
    mkflr(7049489866514174, -53),
    mkflr(5606632771683968, -53),
    mkflr(-5606632771683968, -53),
    mkflr(7049489866514174, -53),
    mkflr(8162032288300481, -56),
    mkflr(8949230140998484, -53),
    mkflr(-8949230140998484, -53),
    mkflr(8162032288300481, -56),
    mkflr(8860043409240618, -53),
    mkflr(6486008573510911, -55),
    mkflr(-6486008573510911, -55),
    mkflr(8860043409240618, -53),
    mkflr(5118421614990306, -53),
    mkflr(7411571937572131, -53),
    mkflr(-7411571937572131, -53),
    mkflr(5118421614990306, -53),
    mkflr(7565090757143791, -53),
    mkflr(4888664464941756, -53),
    mkflr(-4888664464941756, -53),
    mkflr(7565090757143791, -53),
    mkflr(7570076722248107, -55),
    mkflr(8806134768774068, -53),
    mkflr(-8806134768774068, -53),
    mkflr(7570076722248107, -55),
    mkflr(8373460784215450, -53),
    mkflr(6637708312305582, -54),
    mkflr(-6637708312305582, -54),
    mkflr(8373460784215450, -53),
    mkflr(7148293245867151, -54),
    mkflr(8267715182103167, -53),
    mkflr(-8267715182103167, -53),
    mkflr(7148293245867151, -54),
    mkflr(6465998534826869, -53),
    mkflr(6270606139937627, -53),
    mkflr(-6270606139937627, -53),
    mkflr(6465998534826869, -53),
    mkflr(8842450394781643, -59),
    mkflr(9006139534818257, -53),
    mkflr(-9006139534818257, -53),
    mkflr(8842450394781643, -59),
    mkflr(9005122242792311, -53),
    mkflr(6189482235310630, -58),
    mkflr(-6189482235310630, -58),
    mkflr(9005122242792311, -53),
    mkflr(6230813476397823, -53),
    mkflr(6504352530186687, -53),
    mkflr(-6504352530186687, -53),
    mkflr(6230813476397823, -53),
    mkflr(8245628993303844, -53),
    mkflr(7249618174605810, -54),
    mkflr(-7249618174605810, -54),
    mkflr(8245628993303844, -53),
    mkflr(6534826180350098, -54),
    mkflr(8393667262452058, -53),
    mkflr(-8393667262452058, -53),
    mkflr(6534826180350098, -54),
    mkflr(8794356716387429, -53),
    mkflr(7786067926277549, -55),
    mkflr(-7786067926277549, -55),
    mkflr(8794356716387429, -53),
    mkflr(4842153912968527, -53),
    mkflr(7594944627693494, -53),
    mkflr(-7594944627693494, -53),
    mkflr(4842153912968527, -53),
    mkflr(7380026372209606, -53),
    mkflr(5163801812627728, -53),
    mkflr(-5163801812627728, -53),
    mkflr(7380026372209606, -53),
    mkflr(6268429658850061, -55),
    mkflr(8869825971537420, -53),
    mkflr(-8869825971537420, -53),
    mkflr(6268429658850061, -55),
    mkflr(8942801513192182, -53),
    mkflr(8601170191100479, -56),
    mkflr(-8601170191100479, -56),
    mkflr(8942801513192182, -53),
    mkflr(5563272371750168, -53),
    mkflr(7083758813816853, -53),
    mkflr(-7083758813816853, -53),
    mkflr(5563272371750168, -53),
    mkflr(7850630614963393, -53),
    mkflr(8831135229857187, -54),
    mkflr(-8831135229857187, -54),
    mkflr(7850630614963393, -53),
    mkflr(4857912682255224, -54),
    mkflr(8673511947735049, -53),
    mkflr(-8673511947735049, -53),
    mkflr(4857912682255224, -54),
    mkflr(8561217456919463, -53),
    mkflr(5598283333288561, -54),
    mkflr(-5598283333288561, -54),
    mkflr(8561217456919463, -53),
    mkflr(8148805730028833, -54),
    mkflr(8032986972986387, -53),
    mkflr(-8032986972986387, -53),
    mkflr(8148805730028833, -54),
    mkflr(6838348441158650, -53),
    mkflr(5862305776050047, -53),
    mkflr(-5862305776050047, -53),
    mkflr(6838348441158650, -53),
    mkflr(5521331097805465, -56),
    mkflr(8980718722493792, -53),
    mkflr(-8980718722493792, -53),
    mkflr(5521331097805465, -56),
    mkflr(8984784444342543, -53),
    mkflr(5080389927126093, -56),
    mkflr(-5080389927126093, -56),
    mkflr(8984784444342543, -53),
    mkflr(5904154737026182, -53),
    mkflr(6802249279161855, -53),
    mkflr(-6802249279161855, -53),
    mkflr(5904154737026182, -53),
    mkflr(8057835820270665, -53),
    mkflr(8050073368155017, -54),
    mkflr(-8050073368155017, -54),
    mkflr(8057835820270665, -53),
    mkflr(5703239232730864, -54),
    mkflr(8543881084037075, -53),
    mkflr(-8543881084037075, -53),
    mkflr(5703239232730864, -54),
    mkflr(8688252467250769, -53),
    mkflr(4751381895793102, -54),
    mkflr(-4751381895793102, -54),
    mkflr(8688252467250769, -53),
    mkflr(8927310113985246, -54),
    mkflr(7823389415514919, -53),
    mkflr(-7823389415514919, -53),
    mkflr(8927310113985246, -54),
    mkflr(7117761061603948, -53),
    mkflr(5519702517755945, -53),
    mkflr(-5519702517755945, -53),
    mkflr(7117761061603948, -53),
    mkflr(4519992132352091, -55),
    mkflr(8936036193963400, -53),
    mkflr(-8936036193963400, -53),
    mkflr(4519992132352091, -55),
    mkflr(8879274589899640, -53),
    mkflr(6050614741355486, -55),
    mkflr(-6050614741355486, -55),
    mkflr(8879274589899640, -53),
    mkflr(5208987596045498, -53),
    mkflr(7348202953025374, -53),
    mkflr(-7348202953025374, -53),
    mkflr(5208987596045498, -53),
    mkflr(7624512552870645, -53),
    mkflr(4795461056637271, -53),
    mkflr(-4795461056637271, -53),
    mkflr(7624512552870645, -53),
    mkflr(8001765989250269, -55),
    mkflr(8782247561441008, -53),
    mkflr(-8782247561441008, -53),
    mkflr(8001765989250269, -55),
    mkflr(8413557723860353, -53),
    mkflr(6431698015882422, -54),
    mkflr(-6431698015882422, -54),
    mkflr(8413557723860353, -53),
    mkflr(7350670159317696, -54),
    mkflr(8223232361233372, -53),
    mkflr(-8223232361233372, -53),
    mkflr(7350670159317696, -54),
    mkflr(6542461640350018, -53),
    mkflr(6190786226252304, -53),
    mkflr(-6190786226252304, -53),
    mkflr(6542461640350018, -53),
    mkflr(7957506242722589, -58),
    mkflr(9003765913003641, -53),
    mkflr(-9003765913003641, -53),
    mkflr(7957506242722589, -58),
    mkflr(8997663271522660, -53),
    mkflr(6629757244884614, -57),
    mkflr(-6629757244884614, -57),
    mkflr(8997663271522660, -53),
    mkflr(6069312070034399, -53),
    mkflr(6655305358219218, -53),
    mkflr(-6655305358219218, -53),
    mkflr(6069312070034399, -53),
    mkflr(8154188295849595, -53),
    mkflr(7652150456031602, -54),
    mkflr(-7652150456031602, -54),
    mkflr(8154188295849595, -53),
    mkflr(6120876200014774, -54),
    mkflr(8471325578127065, -53),
    mkflr(-8471325578127065, -53),
    mkflr(6120876200014774, -54),
    mkflr(8743938102497119, -53),
    mkflr(8647020179743560, -55),
    mkflr(-8647020179743560, -55),
    mkflr(8743938102497119, -53),
    mkflr(4654306275012748, -53),
    mkflr(7711489578089543, -53),
    mkflr(-7711489578089543, -53),
    mkflr(4654306275012748, -53),
    mkflr(7251077605914050, -53),
    mkflr(5343361485770773, -53),
    mkflr(-5343361485770773, -53),
    mkflr(7251077605914050, -53),
    mkflr(5395836020528807, -55),
    mkflr(8905613286971281, -53),
    mkflr(-8905613286971281, -53),
    mkflr(5395836020528807, -55),
    mkflr(8913722698169820, -53),
    mkflr(5177159182005257, -55),
    mkflr(-5177159182005257, -55),
    mkflr(8913722698169820, -53),
    mkflr(5387752674272799, -53),
    mkflr(7218154856711858, -53),
    mkflr(-7218154856711858, -53),
    mkflr(5387752674272799, -53),
    mkflr(7739902697902825, -53),
    mkflr(4606901848488119, -53),
    mkflr(-4606901848488119, -53),
    mkflr(7739902697902825, -53),
    mkflr(8861464584337410, -55),
    mkflr(8730509220737932, -53),
    mkflr(-8730509220737932, -53),
    mkflr(8861464584337410, -55),
    mkflr(8489944602974586, -53),
    mkflr(6016802823104436, -54),
    mkflr(-6016802823104436, -54),
    mkflr(8489944602974586, -53),
    mkflr(7752072724043411, -54),
    mkflr(8130558439301216, -53),
    mkflr(-8130558439301216, -53),
    mkflr(7752072724043411, -54),
    mkflr(6692420672738099, -53),
    mkflr(6028361630966943, -53),
    mkflr(-6028361630966943, -53),
    mkflr(6692420672738099, -53),
    mkflr(7512970424714007, -57),
    mkflr(8994951428947667, -53),
    mkflr(-8994951428947667, -53),
    mkflr(7512970424714007, -57),
    mkflr(8966493518975884, -53),
    mkflr(6842840994885793, -56),
    mkflr(-6842840994885793, -56),
    mkflr(8966493518975884, -53),
    mkflr(5735440961974946, -53),
    mkflr(6945095779491208, -53),
    mkflr(-6945095779491208, -53),
    mkflr(5735440961974946, -53),
    mkflr(7956629605695492, -53),
    mkflr(8443147217093086, -54),
    mkflr(-8443147217093086, -54),
    mkflr(7956629605695492, -53),
    mkflr(5282166847391008, -54),
    mkflr(8611290075458352, -53),
    mkflr(-8611290075458352, -53),
    mkflr(5282166847391008, -54),
    mkflr(8627333353592832, -53),
    mkflr(5176391646926010, -54),
    mkflr(-5176391646926010, -54),
    mkflr(8627333353592832, -53),
    mkflr(8540630200145957, -54),
    mkflr(7930576735691761, -53),
    mkflr(-7930576735691761, -53),
    mkflr(8540630200145957, -54),
    mkflr(6980157044180565, -53),
    mkflr(5692718687339392, -53),
    mkflr(-5692718687339392, -53),
    mkflr(6980157044180565, -53),
    mkflr(7282851139856476, -56),
    mkflr(8961076366892190, -53),
    mkflr(-8961076366892190, -53),
    mkflr(7282851139856476, -56),
    mkflr(8839477938633966, -53),
    mkflr(6920425636632580, -55),
    mkflr(-6920425636632580, -55),
    mkflr(8839477938633966, -53),
    mkflr(5027084818466930, -53),
    mkflr(7473824766646994, -53),
    mkflr(-7473824766646994, -53),
    mkflr(5027084818466930, -53),
    mkflr(7504529686575502, -53),
    mkflr(4981131658359743, -53),
    mkflr(-4981131658359743, -53),
    mkflr(7504529686575502, -53),
    mkflr(7137247429536506, -55),
    mkflr(8828695804602461, -53),
    mkflr(-8828695804602461, -53),
    mkflr(7137247429536506, -55),
    mkflr(8332102832176454, -53),
    mkflr(6842718994272319, -54),
    mkflr(-6842718994272319, -54),
    mkflr(8332102832176454, -53),
    mkflr(6944839825747268, -54),
    mkflr(8310952915477583, -53),
    mkflr(-8310952915477583, -53),
    mkflr(6944839825747268, -54),
    mkflr(6388561673708188, -53),
    mkflr(6349481723403377, -53),
    mkflr(-6349481723403377, -53),
    mkflr(6388561673708188, -53),
    mkflr(7074226654454970, -61),
    mkflr(9007156865146114, -53),
    mkflr(-9007156865146114, -53),
    mkflr(7074226654454970, -61),
];

// Removed fn-dsa-sign specific tests that depend on external crates

// ========================================================================
// Runtime dispatch wrappers (use AVX2 when available on x86_64)
// ========================================================================

/// FFT with AVX2 runtime dispatch - public API that automatically uses best available
/// implementation.
#[cfg(target_arch = "x86_64")]
#[inline]
pub(crate) fn FFT_dispatch(logn: u32, f: &mut [FLR]) {
    if is_x86_feature_detected!("avx2") {
        unsafe { poly_avx2::FFT(logn, f) }
    } else {
        FFT_impl(logn, f)
    }
}

/// iFFT with AVX2 runtime dispatch - public API that automatically uses best available
/// implementation.
#[cfg(target_arch = "x86_64")]
#[inline]
pub(crate) fn iFFT_dispatch(logn: u32, f: &mut [FLR]) {
    if is_x86_feature_detected!("avx2") {
        unsafe { poly_avx2::iFFT(logn, f) }
    } else {
        iFFT_impl(logn, f)
    }
}

// On non-x86_64, dispatch functions are just aliases to the regular implementations
#[cfg(not(target_arch = "x86_64"))]
#[inline(always)]
pub(crate) fn FFT_dispatch(logn: u32, f: &mut [FLR]) {
    FFT_impl(logn, f)
}

#[cfg(not(target_arch = "x86_64"))]
#[inline(always)]
pub(crate) fn iFFT_dispatch(logn: u32, f: &mut [FLR]) {
    iFFT_impl(logn, f)
}

// Maintain the old names as aliases for compatibility
pub(crate) use FFT_dispatch as FFT;
pub(crate) use iFFT_dispatch as iFFT;

// ========================================================================
// FFT - Forward transform (converts polynomial from normal to FFT representation)
// ========================================================================

/// Convert a polynomial from normal representation to FFT.
///
/// Storage format: First n/2 elements are real parts, next n/2 are imaginary parts.
/// The first iteration would be a no-op (computing f[j] + i*f[j + n/2]), so we start at iteration
/// 2.
///
/// This is the SSE2/NEON/scalar implementation. On x86_64, prefer FFT() which dispatches to AVX2
/// when available.
fn FFT_impl(logn: u32, f: &mut [FLR]) {
    // First iteration of FFT would compute f[j] + i*f[j + n/2] for all j < n/2;
    // since this is exactly our storage format for complex numbers in FFT representation,
    // that first iteration is a no-op, so we start at the second iteration.

    #[cfg(target_feature = "sse2")]
    unsafe {
        #[cfg(target_arch = "x86")]
        use core::arch::x86::*;
        #[cfg(target_arch = "x86_64")]
        use core::arch::x86_64::*;
        use core::mem::transmute;

        assert!(logn >= 1);
        let n = 1usize << logn;
        let hn = n >> 1;
        let mut t = hn;
        let ff: *mut f64 = transmute(f.as_mut_ptr());
        let ggm: *const f64 = transmute((&GM).as_ptr());
        for lm in 1..(logn - 1) {
            let m = 1 << lm;
            let hm = m >> 1;
            let ht = t >> 1;
            let mut j0 = 0;
            for i in 0..hm {
                let s = _mm_loadu_pd(ggm.wrapping_add((m + i) << 1));
                let s_re = _mm_shuffle_pd(s, s, 0);
                let s_im = _mm_shuffle_pd(s, s, 3);
                for j in 0..(ht >> 1) {
                    let j1 = j0 + (j << 1);
                    let j2 = j1 + ht;
                    let x_re = _mm_loadu_pd(ff.wrapping_add(j1));
                    let x_im = _mm_loadu_pd(ff.wrapping_add(j1 + hn));
                    let y_re = _mm_loadu_pd(ff.wrapping_add(j2));
                    let y_im = _mm_loadu_pd(ff.wrapping_add(j2 + hn));
                    let z_re = _mm_sub_pd(_mm_mul_pd(y_re, s_re), _mm_mul_pd(y_im, s_im));
                    let z_im = _mm_add_pd(_mm_mul_pd(y_im, s_re), _mm_mul_pd(y_re, s_im));
                    _mm_storeu_pd(ff.wrapping_add(j1), _mm_add_pd(x_re, z_re));
                    _mm_storeu_pd(ff.wrapping_add(j1 + hn), _mm_add_pd(x_im, z_im));
                    _mm_storeu_pd(ff.wrapping_add(j2), _mm_sub_pd(x_re, z_re));
                    _mm_storeu_pd(ff.wrapping_add(j2 + hn), _mm_sub_pd(x_im, z_im));
                }
                j0 += t;
            }
            t = ht;
        }

        /* Last iteration: m = n/2, hm = n/4, t = 2, ht = 1 */
        if logn >= 2 {
            let cz = _mm_castsi128_pd(_mm_setr_epi32(0, 0, 0, -0x80000000));
            for i in 0..(hn >> 1) {
                let s = _mm_loadu_pd(ggm.wrapping_add(n + (i << 1)));
                let xy_re = _mm_loadu_pd(ff.wrapping_add(i << 1));
                let xy_im = _mm_loadu_pd(ff.wrapping_add((i << 1) + hn));
                let y1 = _mm_shuffle_pd(xy_re, xy_im, 3);
                let y2 = _mm_shuffle_pd(xy_im, xy_re, 3);
                let z_re = _mm_mul_pd(y1, s);
                let z_im = _mm_mul_pd(y2, s);
                let u_re = _mm_sub_pd(z_re, _mm_shuffle_pd(z_re, z_re, 1));
                let u_im = _mm_xor_pd(cz, _mm_add_pd(z_im, _mm_shuffle_pd(z_im, z_im, 1)));
                let u_re = _mm_add_pd(u_re, _mm_shuffle_pd(xy_re, xy_re, 0));
                let u_im = _mm_add_pd(u_im, _mm_shuffle_pd(xy_im, xy_im, 0));
                _mm_storeu_pd(ff.wrapping_add(i << 1), u_re);
                _mm_storeu_pd(ff.wrapping_add((i << 1) + hn), u_im);
            }
        }
    }

    #[cfg(any(target_arch = "aarch64", target_arch = "arm64ec"))]
    unsafe {
        use core::{arch::aarch64::*, mem::transmute};

        assert!(logn >= 1);
        let n = 1usize << logn;
        let hn = n >> 1;
        let mut t = hn;
        let ff: *mut f64 = transmute(f.as_mut_ptr());
        let ggm: *const f64 = transmute((&GM).as_ptr());
        for lm in 1..(logn - 1) {
            let m = 1 << lm;
            let hm = m >> 1;
            let ht = t >> 1;
            let mut j0 = 0;
            for i in 0..hm {
                let s = vld1q_f64(ggm.wrapping_add((m + i) << 1));
                let s_re = vzip1q_f64(s, s);
                let s_im = vzip2q_f64(s, s);
                for j in 0..(ht >> 1) {
                    let j1 = j0 + (j << 1);
                    let j2 = j1 + ht;
                    let x_re = vld1q_f64(ff.wrapping_add(j1));
                    let x_im = vld1q_f64(ff.wrapping_add(j1 + hn));
                    let y_re = vld1q_f64(ff.wrapping_add(j2));
                    let y_im = vld1q_f64(ff.wrapping_add(j2 + hn));
                    let z_re = vsubq_f64(vmulq_f64(y_re, s_re), vmulq_f64(y_im, s_im));
                    let z_im = vaddq_f64(vmulq_f64(y_im, s_re), vmulq_f64(y_re, s_im));
                    vst1q_f64(ff.wrapping_add(j1), vaddq_f64(x_re, z_re));
                    vst1q_f64(ff.wrapping_add(j1 + hn), vaddq_f64(x_im, z_im));
                    vst1q_f64(ff.wrapping_add(j2), vsubq_f64(x_re, z_re));
                    vst1q_f64(ff.wrapping_add(j2 + hn), vsubq_f64(x_im, z_im));
                }
                j0 += t;
            }
            t = ht;
        }

        if logn >= 2 {
            let cz: uint64x2_t = transmute([FLR::ZERO, FLR::NZERO]);
            for i in 0..(hn >> 1) {
                let s = vld1q_f64(ggm.wrapping_add(n + (i << 1)));
                let xy_re = vld1q_f64(ff.wrapping_add(i << 1));
                let xy_im = vld1q_f64(ff.wrapping_add((i << 1) + hn));
                let y1 = vzip2q_f64(xy_re, xy_im);
                let y2 = vzip2q_f64(xy_im, xy_re);
                let z_re = vmulq_f64(y1, s);
                let z_im = vmulq_f64(y2, s);
                let u_re = vsubq_f64(z_re, vextq_f64(z_re, z_re, 1));
                let u_im = vreinterpretq_f64_u64(veorq_u64(
                    cz,
                    vreinterpretq_u64_f64(vaddq_f64(z_im, vextq_f64(z_im, z_im, 1))),
                ));
                let u_re = vaddq_f64(u_re, vdupq_laneq_f64(xy_re, 0));
                let u_im = vaddq_f64(u_im, vdupq_laneq_f64(xy_im, 0));
                vst1q_f64(ff.wrapping_add(i << 1), u_re);
                vst1q_f64(ff.wrapping_add((i << 1) + hn), u_im);
            }
        }
    }

    #[cfg(not(any(target_feature = "sse2", target_arch = "aarch64", target_arch = "arm64ec")))]
    {
        assert!(logn >= 1);
        let n = 1usize << logn;
        let hn = n >> 1;
        let mut t = hn;
        for lm in 1..logn {
            let m = 1 << lm;
            let hm = m >> 1;
            let ht = t >> 1;
            let mut j0 = 0;
            for i in 0..hm {
                let s_re = &GM[(m + i) << 1];
                let s_im = &GM[((m + i) << 1) + 1];
                for j in 0..ht {
                    let j1 = j0 + j;
                    let j2 = j1 + ht;
                    let x_re = f[j1];
                    let x_im = f[j1 + hn];
                    let y_re = f[j2];
                    let y_im = f[j2 + hn];
                    let (z_re, z_im) = flc_mul(&y_re, &y_im, s_re, s_im);
                    f[j1] = x_re + z_re;
                    f[j1 + hn] = x_im + z_im;
                    f[j2] = x_re - z_re;
                    f[j2 + hn] = x_im - z_im;
                }
                j0 += t;
            }
            t = ht;
        }
    }
}

// ========================================================================
// iFFT - Inverse transform (converts polynomial from FFT to normal representation)
// ========================================================================

/// Convert a polynomial from FFT representation to normal.
///
/// This is the reverse of FFT. We use the fact that if w = exp(i*k*pi/N),
/// then 1/w is the conjugate of w. Thus, we can get inverses from GM[] by negating
/// the imaginary part.
///
/// The last iteration is a no-op (like the first iteration in FFT).
/// Since we skip it, we must divide by n/2 at the end.
///
/// This is the SSE2/NEON/scalar implementation. On x86_64, prefer iFFT() which dispatches to AVX2
/// when available.
fn iFFT_impl(logn: u32, f: &mut [FLR]) {
    // This is the reverse of FFT. We use the fact that if w = exp(i*k*pi/N),
    // then 1/w is the conjugate of w; thus, we can get inverses from GM[] by
    // simply negating the imaginary part.
    //
    // The last iteration is a no-op (like the first iteration in FFT).
    // Since we skip it, we must divide by n/2 at the end.

    #[cfg(target_feature = "sse2")]
    unsafe {
        #[cfg(target_arch = "x86")]
        use core::arch::x86::*;
        #[cfg(target_arch = "x86_64")]
        use core::arch::x86_64::*;
        use core::mem::transmute;

        assert!(logn >= 1);
        let n = 1usize << logn;
        let hn = n >> 1;
        let ff: *mut f64 = transmute(f.as_mut_ptr());
        let ggm: *const f64 = transmute((&GM).as_ptr());
        if logn >= 2 {
            let cz = _mm_castsi128_pd(_mm_setr_epi32(0, 0, 0, -0x80000000));
            for i in 0..(hn >> 1) {
                let s = _mm_loadu_pd(ggm.wrapping_add(n + (i << 1)));
                let sc = _mm_xor_pd(s, cz);
                let xy_re = _mm_loadu_pd(ff.wrapping_add(i << 1));
                let xy_im = _mm_loadu_pd(ff.wrapping_add((i << 1) + hn));
                let x = _mm_shuffle_pd(xy_re, xy_im, 0);
                let y = _mm_shuffle_pd(xy_re, xy_im, 3);
                let u = _mm_add_pd(x, y);
                let z = _mm_sub_pd(x, y);
                let v1 = _mm_mul_pd(z, s);
                let v2 = _mm_mul_pd(z, _mm_shuffle_pd(sc, sc, 1));
                let v = _mm_add_pd(_mm_shuffle_pd(v1, v2, 2), _mm_shuffle_pd(v1, v2, 1));
                _mm_storeu_pd(ff.wrapping_add(i << 1), _mm_shuffle_pd(u, v, 0));
                _mm_storeu_pd(ff.wrapping_add((i << 1) + hn), _mm_shuffle_pd(u, v, 3));
            }
        }

        let mut t = 2;
        for lm in 2..logn {
            let hm = 1 << (logn - lm);
            let dt = t << 1;
            let mut j0 = 0;
            for i in 0..(hm >> 1) {
                let s = _mm_loadu_pd(ggm.wrapping_add((hm + i) << 1));
                let s_re = _mm_shuffle_pd(s, s, 0);
                let s_im = _mm_shuffle_pd(s, s, 3);
                for j in 0..(t >> 1) {
                    let j1 = j0 + (j << 1);
                    let j2 = j1 + t;
                    let x_re = _mm_loadu_pd(ff.wrapping_add(j1));
                    let x_im = _mm_loadu_pd(ff.wrapping_add(j1 + hn));
                    let y_re = _mm_loadu_pd(ff.wrapping_add(j2));
                    let y_im = _mm_loadu_pd(ff.wrapping_add(j2 + hn));
                    _mm_storeu_pd(ff.wrapping_add(j1), _mm_add_pd(x_re, y_re));
                    _mm_storeu_pd(ff.wrapping_add(j1 + hn), _mm_add_pd(x_im, y_im));
                    let x_re = _mm_sub_pd(x_re, y_re);
                    let x_im = _mm_sub_pd(x_im, y_im);
                    let z_re = _mm_add_pd(_mm_mul_pd(x_re, s_re), _mm_mul_pd(x_im, s_im));
                    let z_im = _mm_sub_pd(_mm_mul_pd(x_im, s_re), _mm_mul_pd(x_re, s_im));
                    _mm_storeu_pd(ff.wrapping_add(j2), z_re);
                    _mm_storeu_pd(ff.wrapping_add(j2 + hn), z_im);
                }
                j0 += dt;
            }
            t = dt;
        }

        // We have logn-1 delayed halvings to perform (divide by n/2)
        if logn >= 2 {
            // INV_POW2[i] = 1/(2^(i + 1))
            const INV_POW2: [f64; 9] = [
                0.50000000000000000000000000000000000000000,
                0.25000000000000000000000000000000000000000,
                0.12500000000000000000000000000000000000000,
                0.062500000000000000000000000000000000000000,
                0.031250000000000000000000000000000000000000,
                0.015625000000000000000000000000000000000000,
                0.0078125000000000000000000000000000000000000,
                0.0039062500000000000000000000000000000000000,
                0.0019531250000000000000000000000000000000000,
            ];
            let e = _mm_set1_pd(INV_POW2[(logn - 2) as usize]);
            for i in 0..hn {
                let x = _mm_loadu_pd(ff.wrapping_add(i << 1));
                let x = _mm_mul_pd(x, e);
                _mm_storeu_pd(ff.wrapping_add(i << 1), x);
            }
        }
    }

    #[cfg(any(target_arch = "aarch64", target_arch = "arm64ec"))]
    unsafe {
        use core::{arch::aarch64::*, mem::transmute};

        assert!(logn >= 1);
        let n = 1usize << logn;
        let hn = n >> 1;
        let ff: *mut f64 = transmute(f.as_mut_ptr());
        let ggm: *const f64 = transmute((&GM).as_ptr());
        if logn >= 2 {
            let cz: uint64x2_t = transmute([FLR::ZERO, FLR::NZERO]);
            for i in 0..(hn >> 1) {
                let s = vld1q_f64(ggm.wrapping_add(n + (i << 1)));
                let sc = vreinterpretq_f64_u64(veorq_u64(cz, vreinterpretq_u64_f64(s)));
                let xy_re = vld1q_f64(ff.wrapping_add(i << 1));
                let xy_im = vld1q_f64(ff.wrapping_add((i << 1) + hn));
                let x = vzip1q_f64(xy_re, xy_im);
                let y = vzip2q_f64(xy_re, xy_im);
                let u = vaddq_f64(x, y);
                let z = vsubq_f64(x, y);
                let v1 = vmulq_f64(z, s);
                let v2 = vmulq_f64(z, vextq_f64(sc, sc, 1));
                let v = vpaddq_f64(v1, v2);
                vst1q_f64(ff.wrapping_add(i << 1), vzip1q_f64(u, v));
                vst1q_f64(ff.wrapping_add((i << 1) + hn), vzip2q_f64(u, v));
            }
        }

        let mut t = 2;
        for lm in 2..logn {
            let hm = 1 << (logn - lm);
            let dt = t << 1;
            let mut j0 = 0;
            for i in 0..(hm >> 1) {
                let s = vld1q_f64(ggm.wrapping_add((hm + i) << 1));
                let s_re = vzip1q_f64(s, s);
                let s_im = vzip2q_f64(s, s);
                for j in 0..(t >> 1) {
                    let j1 = j0 + (j << 1);
                    let j2 = j1 + t;
                    let x_re = vld1q_f64(ff.wrapping_add(j1));
                    let x_im = vld1q_f64(ff.wrapping_add(j1 + hn));
                    let y_re = vld1q_f64(ff.wrapping_add(j2));
                    let y_im = vld1q_f64(ff.wrapping_add(j2 + hn));
                    vst1q_f64(ff.wrapping_add(j1), vaddq_f64(x_re, y_re));
                    vst1q_f64(ff.wrapping_add(j1 + hn), vaddq_f64(x_im, y_im));
                    let x_re = vsubq_f64(x_re, y_re);
                    let x_im = vsubq_f64(x_im, y_im);
                    let z_re = vaddq_f64(vmulq_f64(x_re, s_re), vmulq_f64(x_im, s_im));
                    let z_im = vsubq_f64(vmulq_f64(x_im, s_re), vmulq_f64(x_re, s_im));
                    vst1q_f64(ff.wrapping_add(j2), z_re);
                    vst1q_f64(ff.wrapping_add(j2 + hn), z_im);
                }
                j0 += dt;
            }
            t = dt;
        }

        // We have logn-1 delayed halvings to perform (divide by n/2)
        if logn >= 2 {
            // INV_POW2[i] = 1/(2^(i + 1))
            const INV_POW2: [f64; 9] = [
                0.50000000000000000000000000000000000000000,
                0.25000000000000000000000000000000000000000,
                0.12500000000000000000000000000000000000000,
                0.062500000000000000000000000000000000000000,
                0.031250000000000000000000000000000000000000,
                0.015625000000000000000000000000000000000000,
                0.0078125000000000000000000000000000000000000,
                0.0039062500000000000000000000000000000000000,
                0.0019531250000000000000000000000000000000000,
            ];
            let e = vdupq_n_f64(INV_POW2[(logn - 2) as usize]);
            for i in 0..hn {
                let x = vld1q_f64(ff.wrapping_add(i << 1));
                let x = vmulq_f64(x, e);
                vst1q_f64(ff.wrapping_add(i << 1), x);
            }
        }
    }

    #[cfg(not(any(target_feature = "sse2", target_arch = "aarch64", target_arch = "arm64ec")))]
    {
        assert!(logn >= 1);
        let n = 1usize << logn;
        let hn = n >> 1;
        let mut t = 1;
        for lm in 1..logn {
            let hm = 1 << (logn - lm);
            let dt = t << 1;
            let mut j0 = 0;
            for i in 0..(hm >> 1) {
                let s_re = &GM[(hm + i) << 1];
                let s_im = -&GM[((hm + i) << 1) + 1];
                for j in 0..t {
                    let j1 = j0 + j;
                    let j2 = j1 + t;
                    let x_re = f[j1];
                    let x_im = f[j1 + hn];
                    let y_re = f[j2];
                    let y_im = f[j2 + hn];
                    f[j1] = x_re + y_re;
                    f[j1 + hn] = x_im + y_im;
                    let x_re = x_re - y_re;
                    let x_im = x_im - y_im;
                    let (z_re, z_im) = flc_mul(&x_re, &x_im, s_re, &s_im);
                    f[j2] = z_re;
                    f[j2 + hn] = z_im;
                }
                j0 += dt;
            }
            t = dt;
        }

        // We have logn-1 delayed halvings to perform (divide by n/2)
        FLR::slice_div2e(&mut f[..n], logn - 1);
    }
}

// ========================================================================
// Polynomial conversion and arithmetic
// ========================================================================

/// Set polynomial d from polynomial f with small coefficients.
/// Converts i8 coefficients to FLR representation.
pub(crate) fn poly_set_small(logn: u32, d: &mut [FLR], f: &[i8]) {
    #[cfg(target_feature = "sse2")]
    unsafe {
        #[cfg(target_arch = "x86")]
        use core::arch::x86::*;
        #[cfg(target_arch = "x86_64")]
        use core::arch::x86_64::*;
        use core::mem::transmute;

        assert!(logn >= 2);
        let dd: *mut f64 = transmute(d.as_mut_ptr());
        for i in 0..(1usize << (logn - 2)) {
            let x = _mm_setr_epi32(
                f[(i << 2) + 0] as i32,
                f[(i << 2) + 1] as i32,
                f[(i << 2) + 2] as i32,
                f[(i << 2) + 3] as i32,
            );
            let y0 = _mm_cvtepi32_pd(x);
            let y1 = _mm_cvtepi32_pd(_mm_bsrli_si128(x, 8));
            _mm_storeu_pd(dd.wrapping_add(i << 2), y0);
            _mm_storeu_pd(dd.wrapping_add((i << 2) + 2), y1);
        }
    }

    #[cfg(any(target_arch = "aarch64", target_arch = "arm64ec"))]
    unsafe {
        use core::{arch::aarch64::*, mem::transmute};

        assert!(logn >= 2);
        let ff: *const i8 = transmute(f.as_ptr());
        let dd: *mut f64 = transmute(d.as_mut_ptr());
        if logn >= 3 {
            for i in 0..(1usize << (logn - 3)) {
                let x1 = vld1_s8(ff.wrapping_add(i << 3));
                let x2 = vmovl_s8(x1);
                let x30 = vmovl_s16(vget_low_s16(x2));
                let x31 = vmovl_high_s16(x2);
                let x40 = vmovl_s32(vget_low_s32(x30));
                let x41 = vmovl_high_s32(x30);
                let x42 = vmovl_s32(vget_low_s32(x31));
                let x43 = vmovl_high_s32(x31);

                let y0 = vcvtq_f64_s64(x40);
                let y1 = vcvtq_f64_s64(x41);
                let y2 = vcvtq_f64_s64(x42);
                let y3 = vcvtq_f64_s64(x43);
                vst1q_f64(dd.wrapping_add(i << 3), y0);
                vst1q_f64(dd.wrapping_add((i << 3) + 2), y1);
                vst1q_f64(dd.wrapping_add((i << 3) + 4), y2);
                vst1q_f64(dd.wrapping_add((i << 3) + 6), y3);
            }
        } else {
            for i in 0..4 {
                vst1_f64(dd.wrapping_add(i), vcvt_f64_s64(vcreate_s64(f[i] as u64)));
            }
        }
    }

    #[cfg(not(any(target_feature = "sse2", target_arch = "aarch64", target_arch = "arm64ec")))]
    {
        for i in 0..(1usize << logn) {
            d[i] = FLR::from_i32(f[i] as i32);
        }
    }
}

/// Add polynomial b to polynomial a (a = a + b).
pub(crate) fn poly_add(logn: u32, a: &mut [FLR], b: &[FLR]) {
    #[cfg(target_feature = "sse2")]
    unsafe {
        #[cfg(target_arch = "x86")]
        use core::arch::x86::*;
        #[cfg(target_arch = "x86_64")]
        use core::arch::x86_64::*;
        use core::mem::transmute;

        let aa: *mut f64 = transmute(a.as_mut_ptr());
        let bb: *const f64 = transmute(b.as_ptr());
        if logn >= 1 {
            for i in 0..(1usize << (logn - 1)) {
                let xa = _mm_loadu_pd(aa.wrapping_add(i << 1));
                let xb = _mm_loadu_pd(bb.wrapping_add(i << 1));
                _mm_storeu_pd(aa.wrapping_add(i << 1), _mm_add_pd(xa, xb));
            }
        } else {
            let xa = _mm_load_sd(aa);
            let xb = _mm_load_sd(bb);
            _mm_store_sd(aa, _mm_add_sd(xa, xb));
        }
    }

    #[cfg(any(target_arch = "aarch64", target_arch = "arm64ec"))]
    unsafe {
        use core::{arch::aarch64::*, mem::transmute};

        let aa: *mut f64 = transmute(a.as_mut_ptr());
        let bb: *const f64 = transmute(b.as_ptr());
        if logn >= 1 {
            for i in 0..(1usize << (logn - 1)) {
                let xa = vld1q_f64(aa.wrapping_add(i << 1));
                let xb = vld1q_f64(bb.wrapping_add(i << 1));
                vst1q_f64(aa.wrapping_add(i << 1), vaddq_f64(xa, xb));
            }
        } else {
            let xa = vld1_f64(aa);
            let xb = vld1_f64(bb);
            vst1_f64(aa, vadd_f64(xa, xb));
        }
    }

    #[cfg(not(any(target_feature = "sse2", target_arch = "aarch64", target_arch = "arm64ec")))]
    {
        let n = 1usize << logn;
        for i in 0..n {
            a[i] += b[i];
        }
    }
}

/// Subtract polynomial b from polynomial a (a = a - b).
pub(crate) fn poly_sub(logn: u32, a: &mut [FLR], b: &[FLR]) {
    #[cfg(target_feature = "sse2")]
    unsafe {
        #[cfg(target_arch = "x86")]
        use core::arch::x86::*;
        #[cfg(target_arch = "x86_64")]
        use core::arch::x86_64::*;
        use core::mem::transmute;

        let aa: *mut f64 = transmute(a.as_mut_ptr());
        let bb: *const f64 = transmute(b.as_ptr());
        if logn >= 1 {
            for i in 0..(1usize << (logn - 1)) {
                let xa = _mm_loadu_pd(aa.wrapping_add(i << 1));
                let xb = _mm_loadu_pd(bb.wrapping_add(i << 1));
                _mm_storeu_pd(aa.wrapping_add(i << 1), _mm_sub_pd(xa, xb));
            }
        } else {
            let xa = _mm_load_sd(aa);
            let xb = _mm_load_sd(bb);
            _mm_store_sd(aa, _mm_sub_sd(xa, xb));
        }
    }

    #[cfg(any(target_arch = "aarch64", target_arch = "arm64ec"))]
    unsafe {
        use core::{arch::aarch64::*, mem::transmute};

        let aa: *mut f64 = transmute(a.as_mut_ptr());
        let bb: *const f64 = transmute(b.as_ptr());
        if logn >= 1 {
            for i in 0..(1usize << (logn - 1)) {
                let xa = vld1q_f64(aa.wrapping_add(i << 1));
                let xb = vld1q_f64(bb.wrapping_add(i << 1));
                vst1q_f64(aa.wrapping_add(i << 1), vsubq_f64(xa, xb));
            }
        } else {
            let xa = vld1_f64(aa);
            let xb = vld1_f64(bb);
            vst1_f64(aa, vsub_f64(xa, xb));
        }
    }

    #[cfg(not(any(target_feature = "sse2", target_arch = "aarch64", target_arch = "arm64ec")))]
    {
        let n = 1usize << logn;
        for i in 0..n {
            a[i] -= b[i];
        }
    }
}

/// Replace polynomial a with its Hermitian adjoint (conjugate transpose) in FFT representation.
/// For a polynomial in FFT form, the adjoint is computed by negating the imaginary part,
/// which corresponds to negating the upper half of the coefficient array.
pub(crate) fn poly_adj_fft(logn: u32, a: &mut [FLR]) {
    let n = 1usize << logn;
    for i in (n >> 1)..n {
        a[i] = -&a[i];
    }
}

/// Multiply polynomial a with polynomial b in FFT representation (a = a * b).
/// Both polynomials must be in FFT representation.
pub(crate) fn poly_mul_fft(logn: u32, a: &mut [FLR], b: &[FLR]) {
    #[cfg(target_feature = "sse2")]
    unsafe {
        #[cfg(target_arch = "x86")]
        use core::arch::x86::*;
        #[cfg(target_arch = "x86_64")]
        use core::arch::x86_64::*;
        use core::mem::transmute;

        let aa: *mut f64 = transmute(a.as_mut_ptr());
        let bb: *const f64 = transmute(b.as_ptr());
        if logn >= 2 {
            let hn = 1usize << (logn - 1);
            for i in 0..(1usize << (logn - 2)) {
                let xar = _mm_loadu_pd(aa.wrapping_add(i << 1));
                let xai = _mm_loadu_pd(aa.wrapping_add((i << 1) + hn));
                let xbr = _mm_loadu_pd(bb.wrapping_add(i << 1));
                let xbi = _mm_loadu_pd(bb.wrapping_add((i << 1) + hn));
                let xcr = _mm_sub_pd(_mm_mul_pd(xar, xbr), _mm_mul_pd(xai, xbi));
                let xci = _mm_add_pd(_mm_mul_pd(xai, xbr), _mm_mul_pd(xar, xbi));
                _mm_storeu_pd(aa.wrapping_add(i << 1), xcr);
                _mm_storeu_pd(aa.wrapping_add((i << 1) + hn), xci);
            }
        } else {
            let xa = _mm_loadu_pd(aa);
            let xb = _mm_loadu_pd(bb);
            let x1 = _mm_mul_pd(xa, xb);
            let x2 = _mm_mul_pd(xa, _mm_shuffle_pd(xb, xb, 1));
            let xcr = _mm_sub_pd(x1, _mm_shuffle_pd(x1, x1, 1));
            let xci = _mm_add_pd(x2, _mm_shuffle_pd(x2, x2, 1));
            let xc = _mm_shuffle_pd(xcr, xci, 0);
            _mm_storeu_pd(aa, xc);
        }
    }

    #[cfg(any(target_arch = "aarch64", target_arch = "arm64ec"))]
    unsafe {
        use core::{arch::aarch64::*, mem::transmute};

        let aa: *mut f64 = transmute(a.as_mut_ptr());
        let bb: *const f64 = transmute(b.as_ptr());
        if logn >= 2 {
            let hn = 1usize << (logn - 1);
            for i in 0..(1usize << (logn - 2)) {
                let xar = vld1q_f64(aa.wrapping_add(i << 1));
                let xai = vld1q_f64(aa.wrapping_add((i << 1) + hn));
                let xbr = vld1q_f64(bb.wrapping_add(i << 1));
                let xbi = vld1q_f64(bb.wrapping_add((i << 1) + hn));
                let xcr = vsubq_f64(vmulq_f64(xar, xbr), vmulq_f64(xai, xbi));
                let xci = vaddq_f64(vmulq_f64(xai, xbr), vmulq_f64(xar, xbi));
                vst1q_f64(aa.wrapping_add(i << 1), xcr);
                vst1q_f64(aa.wrapping_add((i << 1) + hn), xci);
            }
        } else {
            let cz: uint64x2_t = transmute([FLR::ZERO, FLR::NZERO]);
            let xa = vld1q_f64(aa);
            let xb = vld1q_f64(bb);
            let xcr = vmulq_f64(xa, xb);
            let xci = vmulq_f64(xa, vextq_f64(xb, xb, 1));
            let xcr = vreinterpretq_f64_u64(veorq_u64(vreinterpretq_u64_f64(xcr), cz));
            let xc = vpaddq_f64(xcr, xci);
            vst1q_f64(aa, xc);
        }
    }

    #[cfg(not(any(target_feature = "sse2", target_arch = "aarch64", target_arch = "arm64ec")))]
    {
        let hn = 1usize << (logn - 1);
        for i in 0..hn {
            let a_re = &a[i];
            let a_im = &a[i + hn];
            let b_re = &b[i];
            let b_im = &b[i + hn];
            let (c_re, c_im) = flc_mul(a_re, a_im, b_re, b_im);
            a[i] = c_re;
            a[i + hn] = c_im;
        }
    }
}

/// Multiply polynomial a with the adjoint of polynomial b in FFT representation (a = a * adj(b)).
/// Both polynomials must be in FFT representation.
/// This is equivalent to: a = a * conj(b), where conj negates the imaginary part.
pub(crate) fn poly_muladj_fft(logn: u32, a: &mut [FLR], b: &[FLR]) {
    #[cfg(target_feature = "sse2")]
    unsafe {
        #[cfg(target_arch = "x86")]
        use core::arch::x86::*;
        #[cfg(target_arch = "x86_64")]
        use core::arch::x86_64::*;
        use core::mem::transmute;

        let aa: *mut f64 = transmute(a.as_mut_ptr());
        let bb: *const f64 = transmute(b.as_ptr());
        if logn >= 2 {
            let hn = 1usize << (logn - 1);
            for i in 0..(1usize << (logn - 2)) {
                let xar = _mm_loadu_pd(aa.wrapping_add(i << 1));
                let xai = _mm_loadu_pd(aa.wrapping_add((i << 1) + hn));
                let xbr = _mm_loadu_pd(bb.wrapping_add(i << 1));
                let xbi = _mm_loadu_pd(bb.wrapping_add((i << 1) + hn));
                let xcr = _mm_add_pd(_mm_mul_pd(xar, xbr), _mm_mul_pd(xai, xbi));
                let xci = _mm_sub_pd(_mm_mul_pd(xai, xbr), _mm_mul_pd(xar, xbi));
                _mm_storeu_pd(aa.wrapping_add(i << 1), xcr);
                _mm_storeu_pd(aa.wrapping_add((i << 1) + hn), xci);
            }
        } else {
            let xa = _mm_loadu_pd(aa);
            let xb = _mm_loadu_pd(bb);
            let x1 = _mm_mul_pd(xa, xb);
            let x2 = _mm_mul_pd(xa, _mm_shuffle_pd(xb, xb, 1));
            let xcr = _mm_add_pd(x1, _mm_shuffle_pd(x1, x1, 1));
            let xci = _mm_sub_pd(x2, _mm_shuffle_pd(x2, x2, 1));
            let xc = _mm_shuffle_pd(xcr, xci, 2);
            _mm_storeu_pd(aa, xc);
        }
    }

    #[cfg(any(target_arch = "aarch64", target_arch = "arm64ec"))]
    unsafe {
        use core::{arch::aarch64::*, mem::transmute};

        let aa: *mut f64 = transmute(a.as_mut_ptr());
        let bb: *const f64 = transmute(b.as_ptr());
        if logn >= 2 {
            let hn = 1usize << (logn - 1);
            for i in 0..(1usize << (logn - 2)) {
                let xar = vld1q_f64(aa.wrapping_add(i << 1));
                let xai = vld1q_f64(aa.wrapping_add((i << 1) + hn));
                let xbr = vld1q_f64(bb.wrapping_add(i << 1));
                let xbi = vld1q_f64(bb.wrapping_add((i << 1) + hn));
                let xcr = vaddq_f64(vmulq_f64(xar, xbr), vmulq_f64(xai, xbi));
                let xci = vsubq_f64(vmulq_f64(xai, xbr), vmulq_f64(xar, xbi));
                vst1q_f64(aa.wrapping_add(i << 1), xcr);
                vst1q_f64(aa.wrapping_add((i << 1) + hn), xci);
            }
        } else {
            let cz: uint64x2_t = transmute([FLR::ZERO, FLR::NZERO]);
            let xa = vld1q_f64(aa);
            let xb = vld1q_f64(bb);
            let xcr = vmulq_f64(xa, xb);
            let xb = vreinterpretq_f64_u64(veorq_u64(vreinterpretq_u64_f64(xb), cz));
            let xci = vmulq_f64(xa, vextq_f64(xb, xb, 1));
            let xc = vpaddq_f64(xcr, xci);
            vst1q_f64(aa, xc);
        }
    }

    #[cfg(not(any(target_feature = "sse2", target_arch = "aarch64", target_arch = "arm64ec")))]
    {
        let hn = 1usize << (logn - 1);
        for i in 0..hn {
            let a_re = &a[i];
            let a_im = &a[i + hn];
            let b_re = &b[i];
            let b_im = -&b[i + hn]; // Negate imaginary part for adjoint
            let (c_re, c_im) = flc_mul(a_re, a_im, b_re, &b_im);
            a[i] = c_re;
            a[i + hn] = c_im;
        }
    }
}

/// Multiply polynomial a with a real constant x.
pub(crate) fn poly_mulconst(logn: u32, a: &mut [FLR], x: FLR) {
    #[cfg(target_feature = "sse2")]
    unsafe {
        #[cfg(target_arch = "x86")]
        use core::arch::x86::*;
        #[cfg(target_arch = "x86_64")]
        use core::arch::x86_64::*;
        use core::mem::transmute;

        let aa: *mut f64 = transmute(a.as_mut_ptr());
        let xf: f64 = transmute(x);
        let xx = _mm_set1_pd(xf);
        if logn >= 1 {
            for i in 0..(1usize << (logn - 1)) {
                let xa = _mm_loadu_pd(aa.wrapping_add(i << 1));
                _mm_storeu_pd(aa.wrapping_add(i << 1), _mm_mul_pd(xa, xx));
            }
        } else {
            let xa = _mm_load_sd(aa);
            _mm_store_sd(aa, _mm_mul_sd(xa, xx));
        }
    }

    #[cfg(any(target_arch = "aarch64", target_arch = "arm64ec"))]
    unsafe {
        use core::{arch::aarch64::*, mem::transmute};

        let aa: *mut f64 = transmute(a.as_mut_ptr());
        let x1: float64x1_t = transmute(x);
        if logn >= 2 {
            let x2 = vdupq_lane_f64(x1, 0);
            for i in 0..(1usize << (logn - 1)) {
                let xa = vld1q_f64(aa.wrapping_add(i << 1));
                vst1q_f64(aa.wrapping_add(i << 1), vmulq_f64(xa, x2));
            }
        } else {
            let xa = vld1_f64(aa);
            vst1_f64(aa, vmul_f64(xa, x1));
        }
    }

    #[cfg(not(any(target_feature = "sse2", target_arch = "aarch64", target_arch = "arm64ec")))]
    {
        for i in 0..(1usize << logn) {
            a[i] *= x;
        }
    }
}

// ========================================================================
// Splitting and merging polynomials (for recursive FFT sampling)
// ========================================================================

/// Split polynomial f = f0(x^2) + x*f1(x^2) in FFT representation.
///
/// Takes polynomial f in FFT form and splits it into two half-degree polynomials f0 and f1.
/// This is used in recursive FFT sampling.
///
/// Special case: if logn == 1, f has only 2 coefficients, so we just copy them.
pub(crate) fn poly_split_fft(logn: u32, f0: &mut [FLR], f1: &mut [FLR], f: &[FLR]) {
    if logn == 1 {
        f0[0] = f[0];
        f1[0] = f[1];
        return;
    }

    let hn = 1usize << (logn - 1);
    let qn = hn >> 1;
    for i in 0..qn {
        let (a_re, a_im) = (&f[i << 1], &f[(i << 1) + hn]);
        let (b_re, b_im) = (&f[(i << 1) + 1], &f[(i << 1) + 1 + hn]);

        let (t_re, t_im) = (a_re + b_re, a_im + b_im);
        f0[i] = t_re.half();
        f0[i + qn] = t_im.half();

        let (t_re, t_im) = (a_re - b_re, a_im - b_im);
        let neg_gm_im = -&GM[((i + hn) << 1) + 1];
        let (u_re, u_im) = flc_mul(&t_re, &t_im, &GM[(i + hn) << 1], &neg_gm_im);
        f1[i] = u_re.half();
        f1[i + qn] = u_im.half();
    }
}

/// Merge two half-degree polynomials f0, f1 into f = f0(x^2) + x*f1(x^2) in FFT representation.
///
/// This is the inverse of poly_split_fft().
/// All polynomials are in FFT representation.
///
/// Special case: if logn == 1, we just copy the coefficients.
pub(crate) fn poly_merge_fft(logn: u32, f: &mut [FLR], f0: &[FLR], f1: &[FLR]) {
    if logn == 1 {
        f[0] = f0[0];
        f[1] = f1[0];
        return;
    }

    let hn = 1usize << (logn - 1);
    let qn = hn >> 1;
    for i in 0..qn {
        let (a_re, a_im) = (&f0[i], &f0[i + qn]);
        let (b_re, b_im) =
            flc_mul(&f1[i], &f1[i + qn], &GM[(i + hn) << 1], &GM[((i + hn) << 1) + 1]);
        f[i << 1] = a_re + b_re;
        f[(i << 1) + hn] = a_im + b_im;
        f[(i << 1) + 1] = a_re - b_re;
        f[(i << 1) + 1 + hn] = a_im - b_im;
    }
}

/// Multiply polynomial with its own adjoint. The polynomial must be in FFT representation.
/// Since the result is a self-adjoint polynomial, coefficients n/2 to n-1 are set to zero.
///
/// This computes: f * adj(f), where adj(f) is the adjoint (complex conjugate in FFT domain).
/// For self-adjoint output, only first n/2 coefficients are non-zero.
pub(crate) fn poly_mulownadj_fft(logn: u32, a: &mut [FLR]) {
    #[cfg(target_feature = "sse2")]
    unsafe {
        #[cfg(target_arch = "x86")]
        use core::arch::x86::*;
        #[cfg(target_arch = "x86_64")]
        use core::arch::x86_64::*;
        use core::mem::transmute;

        let aa: *mut f64 = transmute(a.as_mut_ptr());
        let xz = _mm_setzero_pd();
        if logn >= 2 {
            let hn = 1usize << (logn - 1);
            for i in 0..(1usize << (logn - 2)) {
                let xar = _mm_loadu_pd(aa.wrapping_add(i << 1));
                let xai = _mm_loadu_pd(aa.wrapping_add((i << 1) + hn));
                let xcr = _mm_add_pd(_mm_mul_pd(xar, xar), _mm_mul_pd(xai, xai));
                _mm_storeu_pd(aa.wrapping_add(i << 1), xcr);
                _mm_storeu_pd(aa.wrapping_add((i << 1) + hn), xz);
            }
        } else {
            let xa = _mm_loadu_pd(aa);
            let x1 = _mm_mul_pd(xa, xa);
            let xcr = _mm_add_pd(x1, _mm_shuffle_pd(x1, x1, 1));
            let xc = _mm_shuffle_pd(xcr, xz, 2);
            _mm_storeu_pd(aa, xc);
        }
    }

    #[cfg(any(target_arch = "aarch64", target_arch = "arm64ec"))]
    unsafe {
        use core::{arch::aarch64::*, mem::transmute};

        let aa: *mut f64 = transmute(a.as_mut_ptr());
        let xz = vdupq_lane_f64(vcreate_f64(0), 0);
        if logn >= 2 {
            let hn = 1usize << (logn - 1);
            for i in 0..(1usize << (logn - 2)) {
                let xar = vld1q_f64(aa.wrapping_add(i << 1));
                let xai = vld1q_f64(aa.wrapping_add((i << 1) + hn));
                let xcr = vaddq_f64(vmulq_f64(xar, xar), vmulq_f64(xai, xai));
                vst1q_f64(aa.wrapping_add(i << 1), xcr);
                vst1q_f64(aa.wrapping_add((i << 1) + hn), xz);
            }
        } else {
            let xa = vld1q_f64(aa);
            let xcr = vmulq_f64(xa, xa);
            let xc = vpaddq_f64(xcr, xz);
            vst1q_f64(aa, xc);
        }
    }

    #[cfg(not(any(target_feature = "sse2", target_arch = "aarch64", target_arch = "arm64ec")))]
    {
        let hn = 1usize << (logn - 1);
        for i in 0..hn {
            a[i] = a[i].square() + a[i + hn].square();
            a[i + hn] = FLR::ZERO;
        }
    }
}

/// LDL decomposition of a Gram matrix in FFT representation.
///
/// Input: Gram matrix G = [[g00, g01], [adj(g01), g11]] where g00 and g11 are self-adjoint.
/// Output: LDL decomposition where:
///   - g00 remains unchanged (diagonal d00)
///   - g01 is replaced by l10 = g01 / g00 (lower triangular)
///   - g11 is replaced by d11 = g11 - l10 * adj(l10) * g00 (diagonal)
///
/// This is used in FFT sampling for recursive lattice sampling.
pub(crate) fn poly_LDL_fft(logn: u32, g00: &[FLR], g01: &mut [FLR], g11: &mut [FLR]) {
    let hn = 1usize << (logn - 1);
    for i in 0..hn {
        // g00 and g11 are self-adjoint
        let g00_re = g00[i];
        let (g01_re, g01_im) = (g01[i], g01[i + hn]);
        let g11_re = g11[i];
        let inv_g00_re = FLR::ONE / g00_re;
        let (mu_re, mu_im) = (g01_re * inv_g00_re, g01_im * inv_g00_re);
        let zo_re = mu_re * g01_re + mu_im * g01_im;
        g11[i] = g11_re - zo_re;
        g01[i] = mu_re;
        g01[i + hn] = -mu_im;
    }
}

/// Split operation on a self-adjoint polynomial in FFT representation.
///
/// For a self-adjoint input polynomial f (where coefficients n/2 to n-1 are zero),
/// compute half-size polynomials f0 and f1 such that f = f0(x^2) + x*f1(x^2).
///
/// Properties:
/// - Input f has only first n/2 non-zero coefficients (self-adjoint)
/// - Output f0 is self-adjoint (second half is zero)
/// - Output f1 is arbitrary
///
/// This is used in FFT sampling to split diagonal matrices in the LDL tree.
pub(crate) fn poly_split_selfadj_fft(logn: u32, f0: &mut [FLR], f1: &mut [FLR], f: &[FLR]) {
    // If logn = 1 then the loop is entirely skipped
    if logn == 1 {
        f0[0] = f[0];
        f1[0] = FLR::ZERO;
        return;
    }

    let hn = 1usize << (logn - 1);
    let qn = hn >> 1;
    for i in 0..qn {
        let a_re = f[i << 1];
        let b_re = f[(i << 1) + 1];

        let t_re = a_re + b_re;
        f0[i] = t_re.half();
        f0[i + qn] = FLR::ZERO;

        let t_re = (a_re - b_re).half();
        f1[i] = t_re * GM[(i + hn) << 1];
        f1[i + qn] = t_re * (-GM[((i + hn) << 1) + 1]);
    }
}

#[cfg(test)]
mod tests {
    use alloc::vec::Vec;

    use super::*;

    #[test]
    fn test_fft_ifft_roundtrip() {
        // Test FFT -> iFFT round-trip for logn = 9 (Falcon512)
        let logn = 9;
        let n = 1 << logn;

        // Create a test polynomial with small coefficients
        let mut f = vec![FLR::ZERO; n];
        for i in 0..n {
            f[i] = FLR::from_i32((i % 13) as i32 - 6);
        }

        // Save original
        let original: Vec<FLR> = f.clone();

        // Forward FFT
        FFT(logn, &mut f);

        // Inverse FFT
        iFFT(logn, &mut f);

        // Check that we got back the original (within floating-point tolerance)
        // Tolerance is 2^-20 which is a small number (roughly 0.000001)
        let tolerance = FLR::from_i32(1) / FLR::from_i32(1 << 20);
        for i in 0..n {
            let diff = (f[i] - original[i]).abs();
            assert!(
                diff < tolerance,
                "FFT->iFFT round-trip failed at index {}: got {:?}, expected {:?}, diff = {:?}",
                i,
                f[i],
                original[i],
                diff
            );
        }
    }

    #[test]
    fn test_split_merge_roundtrip() {
        // Test split -> merge round-trip
        let logn = 9;
        let n = 1 << logn;
        let hn = n >> 1;

        // Create test polynomial in FFT representation
        let mut f = vec![FLR::ZERO; n];
        for i in 0..n {
            f[i] = FLR::from_i32((i * 3) as i32);
        }

        let original: Vec<FLR> = f.clone();

        // Split
        let mut f0 = vec![FLR::ZERO; hn];
        let mut f1 = vec![FLR::ZERO; hn];
        poly_split_fft(logn, &mut f0, &mut f1, &f);

        // Merge
        let mut f_merged = vec![FLR::ZERO; n];
        poly_merge_fft(logn, &mut f_merged, &f0, &f1);

        // Check round-trip
        let tolerance = FLR::from_i32(1) / FLR::from_i32(1 << 20);
        for i in 0..n {
            let diff = (f_merged[i] - original[i]).abs();
            assert!(
                diff < tolerance,
                "split->merge round-trip failed at index {}: got {:?}, expected {:?}",
                i,
                f_merged[i],
                original[i]
            );
        }
    }

    #[test]
    fn test_poly_add_sub() {
        let logn = 3;
        let n = 1 << logn;

        let mut a = vec![FLR::from_i32(5); n];
        let b = vec![FLR::from_i32(3); n];

        poly_add(logn, &mut a, &b);
        for i in 0..n {
            assert_eq!(a[i], FLR::from_i32(8));
        }

        poly_sub(logn, &mut a, &b);
        for i in 0..n {
            assert_eq!(a[i], FLR::from_i32(5));
        }
    }

    #[test]
    fn test_flc_mul() {
        // Test complex multiplication: (3 + 4i) * (2 + 5i) = (6 - 20) + (15 + 8)i = -14 + 23i
        let x_re = FLR::from_i32(3);
        let x_im = FLR::from_i32(4);
        let y_re = FLR::from_i32(2);
        let y_im = FLR::from_i32(5);

        let (z_re, z_im) = flc_mul(&x_re, &x_im, &y_re, &y_im);

        assert_eq!(z_re, FLR::from_i32(-14)); // 3*2 - 4*5 = 6 - 20 = -14
        assert_eq!(z_im, FLR::from_i32(23)); // 3*5 + 4*2 = 15 + 8 = 23

        // Test multiplication by zero
        let zero = FLR::ZERO;
        let (z_re, z_im) = flc_mul(&x_re, &x_im, &zero, &zero);
        assert_eq!(z_re, FLR::ZERO);
        assert_eq!(z_im, FLR::ZERO);

        // Test multiplication by one (1 + 0i)
        let one = FLR::from_i32(1);
        let (z_re, z_im) = flc_mul(&x_re, &x_im, &one, &zero);
        assert_eq!(z_re, x_re); // Should get back original
        assert_eq!(z_im, x_im);
    }

    #[test]
    fn test_poly_set_small() {
        let logn = 3;
        let n = 1 << logn;

        // Create small integer polynomial
        let f: Vec<i8> = vec![1, -2, 3, -4, 5, -6, 7, -8];
        let mut d = vec![FLR::ZERO; n];

        // Convert to FLR
        poly_set_small(logn, &mut d, &f);

        // Verify conversion
        for i in 0..n {
            assert_eq!(d[i], FLR::from_i32(f[i] as i32));
        }
    }

    #[test]
    fn test_poly_mul_fft() {
        let logn = 3;
        let n = 1 << logn;
        let hn = n >> 1;

        // Create two simple polynomials in "FFT" representation
        // For simplicity, just use constant values in re/im parts
        let mut a = vec![FLR::ZERO; n];
        let mut b = vec![FLR::ZERO; n];

        for i in 0..hn {
            a[i] = FLR::from_i32(2); // Real part = 2
            a[i + hn] = FLR::from_i32(3); // Imag part = 3
            b[i] = FLR::from_i32(4); // Real part = 4
            b[i + hn] = FLR::from_i32(5); // Imag part = 5
        }

        // Multiply: (2+3i) * (4+5i) = (8-15) + (10+12)i = -7 + 22i
        poly_mul_fft(logn, &mut a, &b);

        for i in 0..hn {
            assert_eq!(a[i], FLR::from_i32(-7)); // Real: 2*4 - 3*5 = -7
            assert_eq!(a[i + hn], FLR::from_i32(22)); // Imag: 2*5 + 3*4 = 22
        }
    }

    #[test]
    fn test_poly_mulconst() {
        let logn = 3;
        let n = 1 << logn;

        let mut a = vec![FLR::from_i32(7); n];
        let x = FLR::from_i32(3);

        poly_mulconst(logn, &mut a, x);

        for i in 0..n {
            assert_eq!(a[i], FLR::from_i32(21)); // 7 * 3 = 21
        }

        // Test multiplication by zero
        poly_mulconst(logn, &mut a, FLR::ZERO);
        for i in 0..n {
            assert_eq!(a[i], FLR::ZERO);
        }
    }

    #[test]
    fn test_poly_split_merge_identity() {
        // Test that split and merge are proper inverses even at logn=1 edge case
        let logn = 1;
        let n = 1 << logn;
        let hn = n >> 1;

        let f = vec![FLR::from_i32(42), FLR::from_i32(17)];
        let original = f.clone();

        let mut f0 = vec![FLR::ZERO; hn];
        let mut f1 = vec![FLR::ZERO; hn];

        poly_split_fft(logn, &mut f0, &mut f1, &f);

        let mut f_merged = vec![FLR::ZERO; n];
        poly_merge_fft(logn, &mut f_merged, &f0, &f1);

        // Should get back exact values for logn=1 case
        assert_eq!(f_merged[0], original[0]);
        assert_eq!(f_merged[1], original[1]);
    }

    #[test]
    fn test_poly_operations_composition() {
        // Test that operations compose correctly
        let logn = 4;
        let n = 1 << logn;

        // Create test polynomial
        let f: Vec<i8> = (0..n).map(|i| (i % 7) as i8).collect();
        let mut d = vec![FLR::ZERO; n];
        poly_set_small(logn, &mut d, &f);

        // Scale by 2
        let two = FLR::from_i32(2);
        poly_mulconst(logn, &mut d, two);

        // Add to itself (should be 4x original)
        let d_copy = d.clone();
        poly_add(logn, &mut d, &d_copy);

        // Verify result is 4x original
        for i in 0..n {
            let expected = FLR::from_i32((f[i] as i32) * 4);
            assert_eq!(d[i], expected);
        }

        // Subtract 2x original (should get 2x original)
        let mut d_half = vec![FLR::ZERO; n];
        poly_set_small(logn, &mut d_half, &f);
        poly_mulconst(logn, &mut d_half, two);
        poly_sub(logn, &mut d, &d_half);

        // Verify result is 2x original
        for i in 0..n {
            let expected = FLR::from_i32((f[i] as i32) * 2);
            assert_eq!(d[i], expected);
        }
    }
}
